<!doctype html>
<html lang="en" dir="ltr">
<head>
<title>Awesome Dat</title>
<meta charset="utf-8">

<link rel="stylesheet" href="/bundle.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/style.css">
</head>
<body>
<div id="choo-root" class="_d4e87350 minidocs flex flex-column m0 h-100">
      <div class="minidocs-header-flex flex">
        <header class="_19f2d18a minidocs-header ph4 w-100 bg-black-90">
    <nav class="flex justify-between">
      <div class="flex items-center">
        <div class="menu-button">
          <a class=" menu-toggle"></a>
        </div>
        <a href="/" title="Awesome Dat" class="inline-flex items-center">
        <img src="/dat-data-logo.svg" alt="Awesome Dat" class="minidocs-header-logo dib w2 h2" />
        <span class="minidocs-header-title ml2 pr2 white">Awesome Dat</span>
      </a>
      </div>
      <div class="minidocs-header-nav flex-grow flex items-center tr ttu">
        <a href="/install" title="Install" class="minidocs-header-link white dim link dn dib-ns mr3-ns">Install</a>
        <a href="http://datproject.org/" title="Home" class="minidocs-header-link white dim link dib mr3-ns">Home</a>
      </div>
    </nav>
  </header>
      </div>
      <main class="minidocs-main-flex flex">
        <div class="minidocs-sidebar-flex open order-0 overflow-auto bg-near-white">
        <div class="_068b628f minidocs-menu pa3">
      <div class="f3 pt2">Welcome</div><div><a href="/awesome-dat" class="content-link ">Awesome Dat</a></div><div class="f3 pt2">Dat Applications</div><div><a href="/dat" class="content-link ">datproject/dat</a></div><div><a href="/dat-desktop" class="content-link ">datproject/dat-desktop</a></div><div class="f3 pt2">Community Applications</div><div><a href="/sciencefair" class="content-link ">codeforscience/sciencefair</a></div><div><a href="/hyperirc" class="content-link ">mafintosh/hyperirc</a></div><div><a href="/soundcloud-archiver" class="content-link ">jondashkyle/soundcloud-archiver</a></div><div><a href="/hypervision" class="content-link ">mafintosh/hypervision</a></div><div><a href="/hypertweet" class="content-link ">joehand/hypertweet</a></div><div><a href="/dat-photos-app" class="content-link ">beakerbrowser/dat-photos-app</a></div><div class="f3 pt2">High-Level APIs</div><div><a href="/dat-node" class="content-link ">datproject/dat-node</a></div><div><a href="/dat-js" class="content-link ">datproject/dat-js</a></div><div><a href="/pauls-dat-api" class="content-link ">beakerbrowser/pauls-dat-api</a></div><div><a href="/node-dat-archive" class="content-link ">beakerbrowser/node-dat-archive</a></div><div class="f3 pt2">Hosting &amp; Dat Management</div><div><a href="/hypercore-archiver" class="content-link ">mafintosh/hypercore-archiver</a></div><div><a href="/hypercloud" class="content-link ">datprotocol/hypercloud</a></div><div><a href="/hashbase" class="content-link ">beakerbrowser/hashbase</a></div><div><a href="/dat-now" class="content-link ">joehand/dat-now</a></div><div><a href="/hypercore-archiver-bot" class="content-link ">mafintosh/hypercore-archiver-bot</a></div><div><a href="/hypercore-archiver-ws" class="content-link ">joehand/hypercore-archiver-ws</a></div><div><a href="/dat-registry-api" class="content-link ">datproject/dat-registry-api</a></div><div><a href="/dat-registry-client" class="content-link ">datproject/dat-registry-client</a></div><div class="f3 pt2">Managing &amp; Aggregating Dats</div><div><a href="/multidat" class="content-link ">datproject/multidat</a></div><div><a href="/multidrive" class="content-link ">datproject/multidrive</a></div><div><a href="/dat-pki" class="content-link ">jayrbolton/dat-pki</a></div><div><a href="/injestdb" class="content-link ">beakerbrowser/injestdb</a></div><div class="f3 pt2">Http Hosting</div><div><a href="/hyperdrive-http" class="content-link ">joehand/hyperdrive-http</a></div><div><a href="/dathttpd" class="content-link ">beakerbrowser/dathttpd</a></div><div class="f3 pt2">Dat Link Utilties</div><div><a href="/dat-dns" class="content-link ">datprotocol/dat-dns</a></div><div><a href="/dat-link-resolve" class="content-link ">joehand/dat-link-resolve</a></div><div><a href="/parse-dat-url" class="content-link ">pfrazee/parse-dat-url</a></div><div><a href="/dat-encoding" class="content-link ">juliangruber/dat-encoding</a></div><div class="f3 pt2">Dat Utilities</div><div><a href="/dat-log" class="content-link ">joehand/dat-log</a></div><div><a href="/dat-ls" class="content-link ">mafintosh/dat-ls</a></div><div><a href="/hyperhealth" class="content-link ">karissa/hyperhealth</a></div><div><a href="/hyperdrive-network-speed" class="content-link ">joehand/hyperdrive-network-speed</a></div><div class="f3 pt2">File Imports &amp; Exports</div><div><a href="/hyperdrive-import-files" class="content-link ">juliangruber/hyperdrive-import-files</a></div><div><a href="/mirror-folder" class="content-link ">mafintosh/mirror-folder</a></div><div><a href="/hyperdrive-staging-area" class="content-link ">pfrazee/hyperdrive-staging-area</a></div><div><a href="/hyperdrive-to-zip-stream" class="content-link ">pfrazee/hyperdrive-to-zip-stream</a></div><div class="f3 pt2">Hypercore Tools</div><div><a href="/hyperpipe" class="content-link ">mafintosh/hyperpipe</a></div><div class="f3 pt2">Dat Core Modules</div><div><a href="/hyperdrive" class="content-link ">mafintosh/hyperdrive</a></div><div><a href="/hypercore" class="content-link ">mafintosh/hypercore</a></div><div class="f3 pt2">CLI Utilities</div><div><a href="/dat-doctor" class="content-link ">joehand/dat-doctor</a></div><div><a href="/dat-ignore" class="content-link ">joehand/dat-ignore</a></div><div><a href="/dat-json" class="content-link ">joehand/dat-json</a></div><div class="f3 pt2">Networking</div><div><a href="/hyperdiscovery" class="content-link ">karissa/hyperdiscovery</a></div><div><a href="/discovery-swarm" class="content-link ">mafintosh/discovery-swarm</a></div><div><a href="/webrtc-swarm" class="content-link ">mafintosh/webrtc-swarm</a></div><div><a href="/dat-swarm-defaults" class="content-link ">joehand/dat-swarm-defaults</a></div><div class="f3 pt2">Lower level networking modules</div><div><a href="/discovery-channel" class="content-link ">maxogden/discovery-channel</a></div><div><a href="/dns-discovery" class="content-link ">mafintosh/dns-discovery</a></div><div><a href="/multicast-dns" class="content-link ">mafintosh/multicast-dns</a></div><div>
            <a href="/bittorrent-dht" class="content-link active">webtorrent/bittorrent-dht</a>
            <div class="minidocs-menu-toc">
              
            </div>
          </div><div><a href="/utp-native" class="content-link ">mafintosh/utp-native</a></div><div><a href="/signalhub" class="content-link ">mafintosh/signalhub</a></div><div class="f3 pt2">Storage</div><div><a href="/dat-storage" class="content-link ">datproject/dat-storage</a></div><div><a href="/dat-secret-storage" class="content-link ">datproject/dat-secret-storage</a></div><div class="f3 pt2">Random Access</div><div><a href="/abstract-random-access" class="content-link ">juliangruber/abstract-random-access</a></div><div><a href="/multi-random-access" class="content-link ">mafintosh/multi-random-access</a></div><div><a href="/random-access-file" class="content-link ">mafintosh/random-access-file</a></div><div><a href="/random-access-memory" class="content-link ">mafintosh/random-access-memory</a></div><div><a href="/random-access-page-files" class="content-link ">mafintosh/random-access-page-files</a></div><div><a href="/dat-http" class="content-link ">datproject/dat-http</a></div><div><a href="/random-access-idb" class="content-link ">substack/random-access-idb</a></div><div class="f3 pt2">Other Related Dat Project Modules</div><div><a href="/peer-network" class="content-link ">mafintosh/peer-network</a></div><div><a href="/hyperdht" class="content-link ">mafintosh/hyperdht</a></div><div class="f3 pt2">Dat Project Organization Stuff</div><div><a href="/datproject.org" class="content-link ">datproject/datproject.org</a></div><div><a href="/discussions" class="content-link ">datproject/discussions</a></div><div><a href="/design" class="content-link ">datproject/design</a></div><div><a href="/dat-elements" class="content-link ">datproject/dat-elements</a></div><div><a href="/dat-colors" class="content-link ">kriesse/dat-colors</a></div><div><a href="/dat-icons" class="content-link ">kriesse/dat-icons</a></div><div><a href="/dat.json" class="content-link ">juliangruber/dat.json</a></div><div class="f3 pt2">Outdated</div><div><a href="/dat.haus" class="content-link ">juliangruber/dat.haus</a></div><div><a href="/hyperfeed" class="content-link ">poga/hyperfeed</a></div><div><a href="/normcore" class="content-link ">yoshuawuyts/normcore</a></div><div><a href="/github-to-hypercore" class="content-link ">yoshuawuyts/github-to-hypercore</a></div><div><a href="/hyperspark" class="content-link ">poga/hyperspark</a></div><div><a href="/hypercore-index" class="content-link ">juliangruber/hypercore-index</a></div><div><a href="/hyperdrive-encoding" class="content-link ">juliangruber/hyperdrive-encoding</a></div><div><a href="/hyperdrive-http-server" class="content-link ">mafintosh/hyperdrive-http-server</a></div><div><a href="/hyperdrive-http" class="content-link ">joehand/hyperdrive-http</a></div><div><a href="/dat-push" class="content-link ">joehand/dat-push</a></div><div><a href="/dat-backup" class="content-link ">joehand/dat-backup</a></div><div><a href="/archiver-server" class="content-link ">joehand/archiver-server</a></div><div><a href="/archiver-api" class="content-link ">joehand/archiver-api</a></div><div><a href="/hyperdrive-ln" class="content-link ">poga/hyperdrive-ln</a></div><div><a href="/hyperdrive-multiwriter" class="content-link ">substack/hyperdrive-multiwriter</a></div><div><a href="/hyperdrive-named-archives" class="content-link ">substack/hyperdrive-named-archives</a></div><div><a href="/git-dat" class="content-link ">substack/git-dat</a></div><div><a href="/jawn" class="content-link ">CfABrigadePhiladelphia/jawn</a></div><div><a href="/dat-archiver" class="content-link ">maxogden/dat-archiver</a></div><div><a href="/hyperdrive-stats" class="content-link ">juliangruber/hyperdrive-stats</a></div><div><a href="/hypercore-stats-server" class="content-link ">karissa/hypercore-stats-server</a></div><div><a href="/hypercore-stats-ui" class="content-link ">mafintosh/hypercore-stats-ui</a></div><div><a href="/zip-to-hyperdrive" class="content-link ">karissa/zip-to-hyperdrive</a></div><div><a href="/url-dat" class="content-link ">joehand/url-dat</a></div><div><a href="/tar-dat" class="content-link ">joehand/tar-dat</a></div><div><a href="/hyperdrive-duplicate" class="content-link ">joehand/hyperdrive-duplicate</a></div>
    </div>
      </div>
        <div id="minidocs-content" class="minidocs-content-flex order-1 overflow-auto">
          <div class="_32076d68 pa3 ph5-ns pv4-ns">
    
    
    <div><h1 id="bittorrent-dht-travistravis-imagetravis-url-npmnpm-imagenpm-url-downloadsdownloads-imagedownloads-url-javascript-style-guidestandard-imagestandard-url"><a href="#bittorrent-dht-travistravis-imagetravis-url-npmnpm-imagenpm-url-downloadsdownloads-imagedownloads-url-javascript-style-guidestandard-imagestandard-url" class="anchor"></a>bittorrent-dht <a href="https://travis-ci.org/webtorrent/bittorrent-dht"><img src="https://img.shields.io/travis/webtorrent/bittorrent-dht/master.svg" alt="travis"></a> <a href="https://npmjs.org/package/bittorrent-dht"><img src="https://img.shields.io/npm/v/bittorrent-dht.svg" alt="npm"></a> <a href="https://npmjs.org/package/bittorrent-dht"><img src="https://img.shields.io/npm/dm/bittorrent-dht.svg" alt="downloads"></a> <a href="https://standardjs.com"><img src="https://img.shields.io/badge/code_style-standard-brightgreen.svg" alt="javascript style guide"></a></h1><h3 id="simple-robust-bittorrent-dht-implementation"><a href="#simple-robust-bittorrent-dht-implementation" class="anchor"></a>Simple, robust, BitTorrent DHT implementation</h3><p>Node.js implementation of the <a href="http://www.bittorrent.org/beps/bep_0005.html">BitTorrent DHT protocol</a>. BitTorrent DHT is the main peer discovery layer for BitTorrent, which allows for trackerless torrents. DHTs are awesome!</p>
<p>This module is used by <a href="http://webtorrent.io">WebTorrent</a>.</p>
<h3 id="features"><a href="#features" class="anchor"></a>features</h3><ul>
<li>complete implementation of the DHT protocol in JavaScript</li>
<li>follows <a href="http://www.bittorrent.org/beps/bep_0005.html">the spec</a></li>
<li>supports <a href="http://bittorrent.org/beps/bep_0044.html">BEP44</a> for storing arbitrary data in the DHT</li>
<li>robust and well-tested<ul>
<li>Comprehensive, fully-offline test suite</li>
<li>Used by <a href="http://webtorrent.io">WebTorrent</a>, <a href="https://www.npmjs.com/package/peerflix">peerflix</a>, and <a href="https://mafintosh.github.io/playback/">Playback</a></li>
</ul>
</li>
<li>efficient recursive lookup algorithm minimizes UDP traffic</li>
<li>supports multiple, concurrent lookups using the same routing table</li>
</ul>
<p>Also see <a href="https://www.npmjs.com/package/bittorrent-tracker">bittorrent-tracker</a>.</p>
<h3 id="install"><a href="#install" class="anchor"></a>install</h3><pre><code>npm <span class="hljs-keyword">install</span> bittorrent-dht
</code></pre><h3 id="example"><a href="#example" class="anchor"></a>example</h3><pre><code>npm <span class="hljs-keyword">install</span> magnet-uri
</code></pre><pre><code class="lang-js"><span class="hljs-keyword">var</span> DHT = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bittorrent-dht'</span>)
<span class="hljs-keyword">var</span> magnet = <span class="hljs-built_in">require</span>(<span class="hljs-string">'magnet-uri'</span>)

<span class="hljs-keyword">var</span> uri = <span class="hljs-string">'magnet:?xt=urn:btih:e3811b9539cacff680e418124272177c47477157'</span>
<span class="hljs-keyword">var</span> parsed = magnet(uri)

<span class="hljs-built_in">console</span>.log(parsed.infoHash) <span class="hljs-comment">// 'e3811b9539cacff680e418124272177c47477157'</span>

<span class="hljs-keyword">var</span> dht = <span class="hljs-keyword">new</span> DHT()

dht.listen(<span class="hljs-number">20000</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'now listening'</span>)
})

dht.on(<span class="hljs-string">'peer'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">peer, infoHash, from</span>) </span>{
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'found potential peer '</span> + peer.host + <span class="hljs-string">':'</span> + peer.port + <span class="hljs-string">' through '</span> + <span class="hljs-keyword">from</span>.address + <span class="hljs-string">':'</span> + <span class="hljs-keyword">from</span>.port)
})

<span class="hljs-comment">// find peers for the given torrent info hash</span>
dht.lookup(parsed.infoHash)
</code></pre>
<h3 id="api"><a href="#api" class="anchor"></a>api</h3><h4 id="dht-new-dhtopts"><a href="#dht-new-dhtopts" class="anchor"></a><code>dht = new DHT([opts])</code></h4><p>Create a new <code>dht</code> instance.</p>
<p>If <code>opts</code> is specified, then the default options (shown below) will be overridden.</p>
<pre><code class="lang-js">{
  <span class="hljs-attr">nodeId</span>: <span class="hljs-string">''</span>,     <span class="hljs-comment">// 160-bit DHT node ID (Buffer or hex string, default: randomly generated)</span>
  bootstrap: [],  <span class="hljs-comment">// bootstrap servers (default: router.bittorrent.com:6881, router.utorrent.com:6881, dht.transmissionbt.com:6881)</span>
  host: <span class="hljs-literal">false</span>,    <span class="hljs-comment">// host of local peer, if specified then announces get added to local table (String, disabled by default)</span>
  concurrency: <span class="hljs-number">16</span> <span class="hljs-comment">// k-rpc option to specify maximum concurrent UDP requests allowed (Number, 16 by default)</span>
  hash: <span class="hljs-built_in">Function</span>  <span class="hljs-comment">// custom hash function to use (Function, SHA1 by default)</span>
}
</code></pre>
<p>To use <code>dht_store</code>, set <code>opts.verify</code> to an ed25519 supercop/ref10
implementation. <code>opts.verify(signature, value, publicKey)</code> should return a
boolean whether the <code>signature</code> and value <code>buffers</code> were generated by the
<code>publicKey</code>.</p>
<p>For example, for <code>dht_store</code> you can do:</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> ed = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ed25519-supercop'</span>)
<span class="hljs-keyword">var</span> dht = <span class="hljs-keyword">new</span> DHT({ <span class="hljs-attr">verify</span>: ed.verify })
</code></pre>
<h4 id="dhtlookupinfohash-callback"><a href="#dhtlookupinfohash-callback" class="anchor"></a><code>dht.lookup(infoHash, [callback])</code></h4><p>Find peers for the given info hash.</p>
<p>This does a recursive lookup in the DHT. Potential peers that are discovered are emitted
as <code>peer</code> events. See the <code>peer</code> event below for more info.</p>
<p><code>infoHash</code> can be a string or Buffer. <code>callback</code> is called when the recursive lookup has
terminated, and is called with two paramaters. The first is an <code>Error</code> or null. The second
is the number of nodes found that had peers. You usually don&#39;t need to use this info and
can simply listen for <code>peer</code> events.</p>
<p>Returns an <code>abort()</code> function that would allow us to abort the query.</p>
<h4 id="dhtlistenport-address-onlistening"><a href="#dhtlistenport-address-onlistening" class="anchor"></a><code>dht.listen([port], [address], [onlistening])</code></h4><p>Make the DHT listen on the given <code>port</code>. If <code>port</code> is undefined, an available port is
automatically picked.</p>
<p>If <code>address</code> is undefined, the DHT will try to listen on all addresses.</p>
<p>If <code>onlistening</code> is defined, it is attached to the <code>listening</code> event.</p>
<h4 id="dhtaddress"><a href="#dhtaddress" class="anchor"></a><code>dht.address()</code></h4><p>Returns an object containing the address information for the listening socket of the DHT.
This object contains <code>address</code>, <code>family</code> and <code>port</code> properties.</p>
<h4 id="dhtannounceinfohash-port-callback"><a href="#dhtannounceinfohash-port-callback" class="anchor"></a><code>dht.announce(infoHash, [port], [callback])</code></h4><p>Announce that the peer, controlling the querying node, is downloading a torrent on a port.</p>
<p>If you omit <code>port</code> the implied port option will be set and other peers will use the public
dht port as your announced port.</p>
<p>If <code>dht.announce</code> is called soon (&lt; 5 minutes) after <code>dht.lookup</code>, then the routing table
generated during the lookup can be re-used, because the &quot;tokens&quot; sent by each node will
still be valid.</p>
<p>If <code>dht.announce</code> is called and there is no cached routing table, then a <code>dht.lookup</code> will
first be performed to discover relevant nodes and get valid &quot;tokens&quot; from each of them.
This will take longer.</p>
<p>A &quot;token&quot; is an opaque value that must be presented for a node to announce that its
controlling peer is downloading a torrent. It must present the token received from the
same queried node in a recent query for peers. This is to prevent malicious hosts from
signing up other hosts for torrents. <strong>All token management is handled internally by this
module.</strong></p>
<p><code>callback</code> will be called when the announce operation has completed, and is called with
a single parameter that is an <code>Error</code> or null.</p>
<h4 id="arr-dhttojson"><a href="#arr-dhttojson" class="anchor"></a><code>arr = dht.toJSON()</code></h4><p>Returns the current state of the DHT, including DHT nodes and BEP44 values.</p>
<pre><code class="lang-json">{
  <span class="hljs-attr">"nodes"</span>: [],
  <span class="hljs-attr">"values"</span>: {}
}
</code></pre>
<p>The DHT nodes, in particular, are useful for persisting the DHT to disk between restarts
of a BitTorrent client (as recommended by the spec). Each node in the array is an object
with <code>host</code> (string) and <code>port</code> (number) properties.</p>
<p>To restore the DHT nodes when instantiating a new <code>DHT</code> object, simply loop over the nodes in the array and add them with the <code>addNode</code> method.</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> dht1 = <span class="hljs-keyword">new</span> DHT()

<span class="hljs-comment">// some time passes ...</span>

<span class="hljs-comment">// destroy the dht</span>
<span class="hljs-keyword">var</span> nodes = dht1.toJSON().nodes
dht1.destroy()

<span class="hljs-comment">// some time passes ...</span>

<span class="hljs-comment">// initialize a new dht with the same routing table as the first</span>
<span class="hljs-keyword">var</span> dht2 = <span class="hljs-keyword">new</span> DHT()

nodes.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">node</span>) </span>{
  dht2.addNode(node)
})
</code></pre>
<h4 id="dhtaddnodenode"><a href="#dhtaddnodenode" class="anchor"></a><code>dht.addNode(node)</code></h4><p>Manually add a node to the DHT routing table. If there is space in the routing table (or
an unresponsive node can be evicted to make space), the node will be added. If not, the
node will not be added. This is useful to call when a peer wire sends a <code>PORT</code> message to
share their DHT port.</p>
<p>A node should look like this:</p>
<pre><code class="lang-js">{
  <span class="hljs-attr">host</span>: nodeHost,
  <span class="hljs-attr">port</span>: nodePort
}
</code></pre>
<h4 id="dhtdestroycallback"><a href="#dhtdestroycallback" class="anchor"></a><code>dht.destroy([callback])</code></h4><p>Destroy the DHT. Closes the socket and cleans up large data structure resources.</p>
<h4 id="dhtputopts-callback"><a href="#dhtputopts-callback" class="anchor"></a><code>dht.put(opts, callback)</code></h4><p>Write an arbitrary payload to the DHT.
(<a href="http://bittorrent.org/beps/bep_0044.html">BEP 44</a>).</p>
<p>For all requests, you must specify:</p>
<ul>
<li><code>opts.v</code> - a buffer payload to write, less than 1000 bytes</li>
</ul>
<p>If you only specify <code>opts.v</code>, the content is considered immutable and the hash
will just be the hash of the content.</p>
<p>Here is a simple example of creating some immutable content on the dht:</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> DHT = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bittorrent-dht'</span>)
<span class="hljs-keyword">var</span> dht = <span class="hljs-keyword">new</span> DHT()
<span class="hljs-keyword">var</span> value = Buffer.alloc(<span class="hljs-number">200</span>).fill(<span class="hljs-string">'abc'</span>)

dht.put({ <span class="hljs-attr">v</span>: value }, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, hash</span>) </span>{
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'error='</span>, err)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'hash='</span>, hash)
})
</code></pre>
<p>For mutable content, the hash will be the hash of the public key, <code>opts.k</code>.
These options are available:</p>
<ul>
<li><code>opts.k</code> - ed25519 public key buffer (32 bytes) (REQUIRED)</li>
<li><code>opts.sign(buf)</code> - function to generate an ed25519 signature buffer (64 bytes) corresponding to the <code>opts.k</code> public key (REQUIRED)</li>
<li><code>opts.seq</code> - optional sequence (integer), must monotonically increase</li>
<li><code>opts.cas</code> - optional previous sequence for compare-and-swap</li>
<li><code>opts.salt</code> - optional salt buffer to include (&lt; 64 bytes) when calculating
the hash of the content. You can use a salt to have multiple mutable addresses
for the same public key <code>opts.k</code>.</li>
</ul>
<p>Note that bittorrent bep44 uses ed25519 supercop/ref10 keys, NOT nacl/sodium
keys. You can use the <a href="https://npmjs.com/package/ed25519-supercop">ed25519-supercop</a>
package to generate the appropriate signatures or
<a href="https://npmjs.com/package/bittorrent-dht-store-keypair">bittorrent-dht-store-keypair</a>
for a more convenient version.</p>
<p>To make a mutable update, you will need to create an elliptic key and pack
values precisely according to the specification, like so:</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> ed = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ed25519-supercop'</span>)
<span class="hljs-keyword">var</span> keypair = ed.createKeyPair(ed.createSeed())

<span class="hljs-keyword">var</span> value = Buffer.alloc(<span class="hljs-number">200</span>).fill(<span class="hljs-string">'whatever'</span>) <span class="hljs-comment">// the payload you want to send</span>
<span class="hljs-keyword">var</span> opts = {
  <span class="hljs-attr">k</span>: keypair.publicKey,
  <span class="hljs-attr">seq</span>: <span class="hljs-number">0</span>,
  <span class="hljs-attr">v</span>: value,
  <span class="hljs-attr">sign</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">buf</span>) </span>{
    <span class="hljs-keyword">return</span> ed.sign(buf, keypair.publicKey, keypair.secretKey)
  }
}

<span class="hljs-keyword">var</span> DHT = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bittorrent-dht'</span>)
<span class="hljs-keyword">var</span> dht = <span class="hljs-keyword">new</span> DHT

dht.put(opts, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, hash</span>) </span>{
  <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'error='</span>, err)
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'hash='</span>, hash)
})
</code></pre>
<p>In either mutable or immutable forms, <code>callback(error, hash, n)</code> fires with an
<code>error</code> if no nodes were able to store the <code>value</code>. <code>n</code> is set the amount of peers
that accepted the <code>put</code> and <code>hash</code>, the location where the mutable or immutable
content can be retrieved (with <code>dht.get(hash)</code>).</p>
<p>Note that you should call <code>.put()</code> every hour for content that you want to keep
alive, since nodes may discard data nodes older than 2 hours.</p>
<p>If you receive a key/value pair and you want to re-add to the dht it to keep it
alive you can just <code>put</code> it again.</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> ed = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ed25519-supercop'</span>)
<span class="hljs-keyword">var</span> dht = <span class="hljs-keyword">new</span> DHT({ <span class="hljs-attr">verify</span>: ed.verify }) <span class="hljs-comment">// you MUST specify the "verify" param if you want to get mutable content, otherwise null will be returned</span>

dht.get(key, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, res</span>) </span>{
  dht.put(res, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    <span class="hljs-comment">// re-added the key/value pair</span>
  })
})
</code></pre>
<h4 id="dhtgethash-callback"><a href="#dhtgethash-callback" class="anchor"></a><code>dht.get(hash, callback)</code></h4><p>Read a data record (created with <code>.put()</code>) from the DHT.
(<a href="http://bittorrent.org/beps/bep_0044.html">BEP 44</a>)</p>
<p>Given <code>hash</code>, a hex string or buffer, lookup data content from the DHT, sending the
result in <code>callback(err, res)</code>.</p>
<p><code>res</code> objects are similar to the options objects written to the DHT with
<code>.put()</code>:</p>
<ul>
<li><code>res.v</code> - the value put in</li>
<li><code>res.id</code> - the node that returned the content</li>
<li><code>res.k</code> - the public key (only present for mutable data)</li>
<li><code>res.sig</code> - the signature (only present for mutable data)</li>
<li><code>res.seq</code> - the sequence (optional, only present for mutable data)</li>
<li><code>res.salt</code> - the salt (optional, only present for mutable data)</li>
</ul>
<h3 id="events"><a href="#events" class="anchor"></a>events</h3><h4 id="dhtonready-function"><a href="#dhtonready-function" class="anchor"></a><code>dht.on(&#39;ready&#39;, function () { ... })</code></h4><p>Emitted when the DHT is fully bootstrapped (i.e. the routing table is sufficiently
populated via the bootstrap nodes). Note that it is okay to do lookups before the &#39;ready&#39;
event fires.</p>
<p>Note: If you initialize the DHT with the <code>{ bootstrap: false }</code> option, then the &#39;ready&#39;
event will fire on the next tick even if there are not any nodes in the routing table.
It is assumed that you will manually populate the routing table with <code>dht.addNode</code> if you
pass this option.</p>
<h4 id="dhtonlistening-function"><a href="#dhtonlistening-function" class="anchor"></a><code>dht.on(&#39;listening&#39;, function () { ... })</code></h4><p>Emitted when the DHT is listening.</p>
<h4 id="dhtonpeer-function-peer-infohash-from"><a href="#dhtonpeer-function-peer-infohash-from" class="anchor"></a><code>dht.on(&#39;peer&#39;, function (peer, infoHash, from) { ... })</code></h4><p>Emitted when a potential peer is found. <code>peer</code> is of the form <code>{host, port}</code>.
<code>infoHash</code> is the torrent info hash of the swarm that the peer belongs to. Emitted
in response to a <code>lookup(infoHash)</code> call.</p>
<h4 id="dhtonerror-function-err"><a href="#dhtonerror-function-err" class="anchor"></a><code>dht.on(&#39;error&#39;, function (err) { ... })</code></h4><p>Emitted when the DHT has a fatal error.</p>
<h4 id="internal-events"><a href="#internal-events" class="anchor"></a>internal events</h4><h4 id="dhtonnode-function-node"><a href="#dhtonnode-function-node" class="anchor"></a><code>dht.on(&#39;node&#39;, function (node) { ... })</code></h4><p>Emitted when the DHT finds a new node.</p>
<h4 id="dhtonannounce-function-peer-infohash"><a href="#dhtonannounce-function-peer-infohash" class="anchor"></a><code>dht.on(&#39;announce&#39;, function (peer, infoHash) { ... })</code></h4><p>Emitted when a peer announces itself in order to be stored in the DHT.</p>
<h4 id="dhtonwarning-function-err"><a href="#dhtonwarning-function-err" class="anchor"></a><code>dht.on(&#39;warning&#39;, function (err) { ... })</code></h4><p>Emitted when the DHT gets an unexpected message from another DHT node. This is purely
informational.</p>
<h3 id="further-reading"><a href="#further-reading" class="anchor"></a>further reading</h3><ul>
<li><a href="http://www.bittorrent.org/beps/bep_0005.html">BitTorrent DHT protocol</a></li>
<li><a href="http://www.ic.unicamp.br/~bit/ensino/mo809_1s13/papers/P2P/Kademlia-%20A%20Peer-to-Peer%20Information%20System%20Based%20on%20the%20XOR%20Metric%20.pdf">Kademlia: A Peer-to-peer Information System Based on the XOR Metric</a></li>
</ul>
<h3 id="license"><a href="#license" class="anchor"></a>license</h3><p>MIT. Copyright (c) <a href="https://feross.org">Feross Aboukhadijeh</a>, Mathias Buus, and <a href="https://webtorrent.io">WebTorrent, LLC</a>.</p>
</div>
  </div>
        </div>
      </main>
    </div>
<script src="/bundle.js"></script>
</body>
</html>
