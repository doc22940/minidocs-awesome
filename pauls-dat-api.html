<!doctype html>
<html lang="en" dir="ltr">
<head>
<title>Awesome Dat</title>
<meta charset="utf-8">

<link rel="stylesheet" href="/bundle.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/style.css">
</head>
<body>
<div id="choo-root" class="_d4e87350 minidocs flex flex-column m0 h-100">
      <div class="minidocs-header-flex flex">
        <header class="_19f2d18a minidocs-header ph4 w-100 bg-black-90">
    <nav class="flex justify-between">
      <div class="flex items-center">
        <div class="menu-button">
          <a class=" menu-toggle"></a>
        </div>
        <a href="/" title="Awesome Dat" class="inline-flex items-center">
        <img src="/dat-data-logo.svg" alt="Awesome Dat" class="minidocs-header-logo dib w2 h2" />
        <span class="minidocs-header-title ml2 pr2 white">Awesome Dat</span>
      </a>
      </div>
      <div class="minidocs-header-nav flex-grow flex items-center tr ttu">
        <a href="/install" title="Install" class="minidocs-header-link white dim link dn dib-ns mr3-ns">Install</a>
        <a href="http://datproject.org/" title="Home" class="minidocs-header-link white dim link dib mr3-ns">Home</a>
      </div>
    </nav>
  </header>
      </div>
      <main class="minidocs-main-flex flex">
        <div class="minidocs-sidebar-flex open order-0 overflow-auto bg-near-white">
        <div class="_068b628f minidocs-menu pa3">
      <div class="f3 pt2">Welcome</div><div><a href="/awesome-dat" class="content-link ">Awesome Dat</a></div><div class="f3 pt2">Dat Applications</div><div><a href="/dat" class="content-link ">datproject/dat</a></div><div><a href="/dat-desktop" class="content-link ">datproject/dat-desktop</a></div><div class="f3 pt2">Community Applications</div><div><a href="/sciencefair" class="content-link ">codeforscience/sciencefair</a></div><div><a href="/hyperirc" class="content-link ">mafintosh/hyperirc</a></div><div><a href="/soundcloud-archiver" class="content-link ">jondashkyle/soundcloud-archiver</a></div><div><a href="/hypervision" class="content-link ">mafintosh/hypervision</a></div><div><a href="/hypertweet" class="content-link ">joehand/hypertweet</a></div><div><a href="/dat-photos-app" class="content-link ">beakerbrowser/dat-photos-app</a></div><div class="f3 pt2">High-Level APIs</div><div><a href="/dat-node" class="content-link ">datproject/dat-node</a></div><div><a href="/dat-js" class="content-link ">datproject/dat-js</a></div><div>
            <a href="/pauls-dat-api" class="content-link active">beakerbrowser/pauls-dat-api</a>
            <div class="minidocs-menu-toc">
              <a href="#staging" class="f5 content-link">Staging</a><a href="#lookup" class="f5 content-link">Lookup</a><a href="#read" class="f5 content-link">Read</a><a href="#write" class="f5 content-link">Write</a><a href="#delete" class="f5 content-link">Delete</a><a href="#network" class="f5 content-link">Network</a><a href="#activity-streams" class="f5 content-link">Activity Streams</a><a href="#exporters" class="f5 content-link">Exporters</a><a href="#manifest" class="f5 content-link">Manifest</a><a href="#helpers" class="f5 content-link">Helpers</a>
            </div>
          </div><div><a href="/node-dat-archive" class="content-link ">beakerbrowser/node-dat-archive</a></div><div class="f3 pt2">Hosting &amp; Dat Management</div><div><a href="/hypercore-archiver" class="content-link ">mafintosh/hypercore-archiver</a></div><div><a href="/hypercloud" class="content-link ">datprotocol/hypercloud</a></div><div><a href="/hashbase" class="content-link ">beakerbrowser/hashbase</a></div><div><a href="/dat-now" class="content-link ">joehand/dat-now</a></div><div><a href="/hypercore-archiver-bot" class="content-link ">mafintosh/hypercore-archiver-bot</a></div><div><a href="/hypercore-archiver-ws" class="content-link ">joehand/hypercore-archiver-ws</a></div><div><a href="/dat-registry-api" class="content-link ">datproject/dat-registry-api</a></div><div><a href="/dat-registry-client" class="content-link ">datproject/dat-registry-client</a></div><div class="f3 pt2">Managing &amp; Aggregating Dats</div><div><a href="/multidat" class="content-link ">datproject/multidat</a></div><div><a href="/multidrive" class="content-link ">datproject/multidrive</a></div><div><a href="/dat-pki" class="content-link ">jayrbolton/dat-pki</a></div><div><a href="/injestdb" class="content-link ">beakerbrowser/injestdb</a></div><div class="f3 pt2">Http Hosting</div><div><a href="/hyperdrive-http" class="content-link ">joehand/hyperdrive-http</a></div><div><a href="/dathttpd" class="content-link ">beakerbrowser/dathttpd</a></div><div class="f3 pt2">Dat Link Utilties</div><div><a href="/dat-dns" class="content-link ">datprotocol/dat-dns</a></div><div><a href="/dat-link-resolve" class="content-link ">joehand/dat-link-resolve</a></div><div><a href="/parse-dat-url" class="content-link ">pfrazee/parse-dat-url</a></div><div><a href="/dat-encoding" class="content-link ">juliangruber/dat-encoding</a></div><div class="f3 pt2">Dat Utilities</div><div><a href="/dat-log" class="content-link ">joehand/dat-log</a></div><div><a href="/dat-ls" class="content-link ">mafintosh/dat-ls</a></div><div><a href="/hyperhealth" class="content-link ">karissa/hyperhealth</a></div><div><a href="/hyperdrive-network-speed" class="content-link ">joehand/hyperdrive-network-speed</a></div><div class="f3 pt2">File Imports &amp; Exports</div><div><a href="/hyperdrive-import-files" class="content-link ">juliangruber/hyperdrive-import-files</a></div><div><a href="/mirror-folder" class="content-link ">mafintosh/mirror-folder</a></div><div><a href="/hyperdrive-staging-area" class="content-link ">pfrazee/hyperdrive-staging-area</a></div><div><a href="/hyperdrive-to-zip-stream" class="content-link ">pfrazee/hyperdrive-to-zip-stream</a></div><div class="f3 pt2">Hypercore Tools</div><div><a href="/hyperpipe" class="content-link ">mafintosh/hyperpipe</a></div><div class="f3 pt2">Dat Core Modules</div><div><a href="/hyperdrive" class="content-link ">mafintosh/hyperdrive</a></div><div><a href="/hypercore" class="content-link ">mafintosh/hypercore</a></div><div class="f3 pt2">CLI Utilities</div><div><a href="/dat-doctor" class="content-link ">joehand/dat-doctor</a></div><div><a href="/dat-ignore" class="content-link ">joehand/dat-ignore</a></div><div><a href="/dat-json" class="content-link ">joehand/dat-json</a></div><div class="f3 pt2">Networking</div><div><a href="/hyperdiscovery" class="content-link ">karissa/hyperdiscovery</a></div><div><a href="/discovery-swarm" class="content-link ">mafintosh/discovery-swarm</a></div><div><a href="/webrtc-swarm" class="content-link ">mafintosh/webrtc-swarm</a></div><div><a href="/dat-swarm-defaults" class="content-link ">joehand/dat-swarm-defaults</a></div><div class="f3 pt2">Lower level networking modules</div><div><a href="/discovery-channel" class="content-link ">maxogden/discovery-channel</a></div><div><a href="/dns-discovery" class="content-link ">mafintosh/dns-discovery</a></div><div><a href="/multicast-dns" class="content-link ">mafintosh/multicast-dns</a></div><div><a href="/bittorrent-dht" class="content-link ">webtorrent/bittorrent-dht</a></div><div><a href="/utp-native" class="content-link ">mafintosh/utp-native</a></div><div><a href="/signalhub" class="content-link ">mafintosh/signalhub</a></div><div class="f3 pt2">Storage</div><div><a href="/dat-storage" class="content-link ">datproject/dat-storage</a></div><div><a href="/dat-secret-storage" class="content-link ">datproject/dat-secret-storage</a></div><div class="f3 pt2">Random Access</div><div><a href="/abstract-random-access" class="content-link ">juliangruber/abstract-random-access</a></div><div><a href="/multi-random-access" class="content-link ">mafintosh/multi-random-access</a></div><div><a href="/random-access-file" class="content-link ">mafintosh/random-access-file</a></div><div><a href="/random-access-memory" class="content-link ">mafintosh/random-access-memory</a></div><div><a href="/random-access-page-files" class="content-link ">mafintosh/random-access-page-files</a></div><div><a href="/dat-http" class="content-link ">datproject/dat-http</a></div><div><a href="/random-access-idb" class="content-link ">substack/random-access-idb</a></div><div class="f3 pt2">Other Related Dat Project Modules</div><div><a href="/peer-network" class="content-link ">mafintosh/peer-network</a></div><div><a href="/hyperdht" class="content-link ">mafintosh/hyperdht</a></div><div class="f3 pt2">Dat Project Organization Stuff</div><div><a href="/datproject.org" class="content-link ">datproject/datproject.org</a></div><div><a href="/discussions" class="content-link ">datproject/discussions</a></div><div><a href="/design" class="content-link ">datproject/design</a></div><div><a href="/dat-elements" class="content-link ">datproject/dat-elements</a></div><div><a href="/dat-colors" class="content-link ">kriesse/dat-colors</a></div><div><a href="/dat-icons" class="content-link ">kriesse/dat-icons</a></div><div><a href="/dat.json" class="content-link ">juliangruber/dat.json</a></div><div class="f3 pt2">Outdated</div><div><a href="/dat.haus" class="content-link ">juliangruber/dat.haus</a></div><div><a href="/hyperfeed" class="content-link ">poga/hyperfeed</a></div><div><a href="/normcore" class="content-link ">yoshuawuyts/normcore</a></div><div><a href="/github-to-hypercore" class="content-link ">yoshuawuyts/github-to-hypercore</a></div><div><a href="/hyperspark" class="content-link ">poga/hyperspark</a></div><div><a href="/hypercore-index" class="content-link ">juliangruber/hypercore-index</a></div><div><a href="/hyperdrive-encoding" class="content-link ">juliangruber/hyperdrive-encoding</a></div><div><a href="/hyperdrive-http-server" class="content-link ">mafintosh/hyperdrive-http-server</a></div><div><a href="/hyperdrive-http" class="content-link ">joehand/hyperdrive-http</a></div><div><a href="/dat-push" class="content-link ">joehand/dat-push</a></div><div><a href="/dat-backup" class="content-link ">joehand/dat-backup</a></div><div><a href="/archiver-server" class="content-link ">joehand/archiver-server</a></div><div><a href="/archiver-api" class="content-link ">joehand/archiver-api</a></div><div><a href="/hyperdrive-ln" class="content-link ">poga/hyperdrive-ln</a></div><div><a href="/hyperdrive-multiwriter" class="content-link ">substack/hyperdrive-multiwriter</a></div><div><a href="/hyperdrive-named-archives" class="content-link ">substack/hyperdrive-named-archives</a></div><div><a href="/git-dat" class="content-link ">substack/git-dat</a></div><div><a href="/jawn" class="content-link ">CfABrigadePhiladelphia/jawn</a></div><div><a href="/dat-archiver" class="content-link ">maxogden/dat-archiver</a></div><div><a href="/hyperdrive-stats" class="content-link ">juliangruber/hyperdrive-stats</a></div><div><a href="/hypercore-stats-server" class="content-link ">karissa/hypercore-stats-server</a></div><div><a href="/hypercore-stats-ui" class="content-link ">mafintosh/hypercore-stats-ui</a></div><div><a href="/zip-to-hyperdrive" class="content-link ">karissa/zip-to-hyperdrive</a></div><div><a href="/url-dat" class="content-link ">joehand/url-dat</a></div><div><a href="/tar-dat" class="content-link ">joehand/tar-dat</a></div><div><a href="/hyperdrive-duplicate" class="content-link ">joehand/hyperdrive-duplicate</a></div>
    </div>
      </div>
        <div id="minidocs-content" class="minidocs-content-flex order-1 overflow-auto">
          <div class="_32076d68 pa3 ph5-ns pv4-ns">
    
    
    <div><h1 id="pauls-dat-api"><a href="#pauls-dat-api" class="anchor"></a>pauls-dat-api</h1><p>A library of functions that make working with <a href="https://github.com/datproject/dat-node">dat</a> / <a href="https://github.com/mafintosh/hyperdrive">hyperdrive</a> easier.
Includes common operations, and some sugars.
These functions were factored out of <a href="https://github.com/beakerbrowser/beaker">beaker browser</a>&#39;s internal APIs.</p>
<p>All async methods work with callbacks and promises. If no callback is provided, a promise will be returned.</p>
<p>Any time a hyperdrive <code>archive</code> is expected, a <a href="https://github.com/pfrazee/hyperdrive-staging-area">hyperdrive-staging-area</a> instance can be provided, unless otherwise stated.</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> hyperdrive = <span class="hljs-built_in">require</span>(<span class="hljs-string">'hyperdrive'</span>)
<span class="hljs-keyword">var</span> hyperstaging = <span class="hljs-built_in">require</span>(<span class="hljs-string">'hyperdrive-staging-area'</span>)

<span class="hljs-keyword">var</span> archive = hyperdrive(<span class="hljs-string">'./my-first-hyperdrive-meta'</span>) <span class="hljs-comment">// metadata will be stored in this folder</span>
<span class="hljs-keyword">var</span> staging = hyperstaging(archive, <span class="hljs-string">'./my-first-hyperdrive'</span>) <span class="hljs-comment">// content will be stored in this folder</span>

<span class="hljs-keyword">await</span> pda.readFile(archive, <span class="hljs-string">'/hello.txt'</span>) <span class="hljs-comment">// read the committed hello.txt</span>
<span class="hljs-keyword">await</span> pda.readFile(staging, <span class="hljs-string">'/hello.txt'</span>) <span class="hljs-comment">// read the local hello.txt</span>
</code></pre>
<p><strong> NOTE: this library is written natively for node 7 and above. </strong></p>
<p>To use with node versions lesser than 7 use:</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> pda = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pauls-dat-api/es5'</span>);
</code></pre>
<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<ul>
<li><a href="#staging">Staging</a><ul>
<li><a href="#diffstaging-opts-cb">diff(staging[, opts, cb])</a></li>
<li><a href="#commitstaging-opts-cb">commit(staging[, opts, cb])</a></li>
<li><a href="#revertstaging-opts-cb">revert(staging[, opts, cb])</a></li>
</ul>
</li>
<li><a href="#lookup">Lookup</a><ul>
<li><a href="#statarchive-name-cb">stat(archive, name[, cb])</a></li>
</ul>
</li>
<li><a href="#read">Read</a><ul>
<li><a href="#readfilearchive-name-opts-cb">readFile(archive, name[, opts, cb])</a></li>
<li><a href="#readdirarchive-path-opts-cb">readdir(archive, path[, opts, cb])</a></li>
</ul>
</li>
<li><a href="#write">Write</a><ul>
<li><a href="#writefilearchive-name-data-opts-cb">writeFile(archive, name, data[, opts, cb])</a></li>
<li><a href="#mkdirarchive-name-cb">mkdir(archive, name[, cb])</a></li>
<li><a href="#copyarchive-sourcename-targetname-cb">copy(archive, sourceName, targetName[, cb])</a></li>
<li><a href="#renamearchive-sourcename-targetname-cb">rename(archive, sourceName, targetName[, cb])</a></li>
</ul>
</li>
<li><a href="#delete">Delete</a><ul>
<li><a href="#unlinkarchive-name-cb">unlink(archive, name[, cb])</a></li>
<li><a href="#rmdirarchive-name-opts-cb">rmdir(archive, name[, opts, cb])</a></li>
</ul>
</li>
<li><a href="#network">Network</a><ul>
<li><a href="#downloadarchive-name-cb">download(archive, name[, cb])</a></li>
</ul>
</li>
<li><a href="#activity-streams">Activity Streams</a><ul>
<li><a href="#createfileactivitystreamarchive-staging-path">createFileActivityStream(archive[, staging, path])</a></li>
<li><a href="#createnetworkactivitystreamarchive">createNetworkActivityStream(archive)</a></li>
</ul>
</li>
<li><a href="#exporters">Exporters</a><ul>
<li><a href="#exportfilesystemtoarchiveopts-cb">exportFilesystemToArchive(opts[, cb])</a></li>
<li><a href="#exportarchivetofilesystemopts-cb">exportArchiveToFilesystem(opts[, cb])</a></li>
<li><a href="#exportarchivetoarchiveopts-cb">exportArchiveToArchive(opts[, cb])</a></li>
</ul>
</li>
<li><a href="#manifest">Manifest</a><ul>
<li><a href="#readmanifestarchive-cb">readManifest(archive[, cb])</a></li>
<li><a href="#writemanifestarchive-manifest-cb">writeManifest(archive, manifest[, cb])</a></li>
<li><a href="#updatemanifestarchive-manifest-cb">updateManifest(archive, manifest[, cb])</a></li>
<li><a href="#generatemanifestopts">generateManifest(opts)</a></li>
</ul>
</li>
<li><a href="#helpers">Helpers</a><ul>
<li><a href="#findentrybycontentblockarchive-block">findEntryByContentBlock(archive, block)</a></li>
</ul>
</li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<pre><code class="lang-js"><span class="hljs-keyword">const</span> pda = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pauls-dat-api'</span>)
</code></pre>
<h2 id="staging"><a href="#staging" class="anchor"></a>Staging</h2><h3 id="diffstaging-opts-cb"><a href="#diffstaging-opts-cb" class="anchor"></a>diff(staging[, opts, cb])</h3><p>List the differences between <code>staging</code> and its <code>archive</code>.</p>
<ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
<li><code>staging</code> HyperdriveStagingArea instance (object).</li>
<li><code>opts.skipIgnore</code> Don&#39;t use staging&#39;s .datignore (bool).</li>
<li>Returns an array of changes.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">await</span> pda.diff(staging)
</code></pre>
<p>Output looks like:</p>
<pre><code class="lang-js">[
  {
    <span class="hljs-attr">change</span>: <span class="hljs-string">'add'</span> | <span class="hljs-string">'mod'</span> | <span class="hljs-string">'del'</span>
    type: <span class="hljs-string">'dir'</span> | <span class="hljs-string">'file'</span>
    path: <span class="hljs-built_in">String</span> (path <span class="hljs-keyword">of</span> the file)
  },
  ...
]
</code></pre>
<h3 id="commitstaging-opts-cb"><a href="#commitstaging-opts-cb" class="anchor"></a>commit(staging[, opts, cb])</h3><p>Apply the changes in <code>staging</code> to its <code>archive</code>.</p>
<ul>
<li><code>staging</code> HyperdriveStagingArea instance (object).</li>
<li><code>opts.skipIgnore</code> Don&#39;t use staging&#39;s .datignore (bool).</li>
<li>Returns an array of the changes applied.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">await</span> pda.commit(staging)
</code></pre>
<p>Output looks like:</p>
<pre><code class="lang-js">[
  {
    <span class="hljs-attr">change</span>: <span class="hljs-string">'add'</span> | <span class="hljs-string">'mod'</span> | <span class="hljs-string">'del'</span>
    type: <span class="hljs-string">'dir'</span> | <span class="hljs-string">'file'</span>
    path: <span class="hljs-built_in">String</span> (path <span class="hljs-keyword">of</span> the file)
  },
  ...
]
</code></pre>
<h3 id="revertstaging-opts-cb"><a href="#revertstaging-opts-cb" class="anchor"></a>revert(staging[, opts, cb])</h3><p>Revert the changes in <code>staging</code> to reflect the state of its <code>archive</code>.</p>
<ul>
<li><code>staging</code> HyperdriveStagingArea instance (object).</li>
<li><code>opts.skipIgnore</code> Don&#39;t use staging&#39;s .datignore (bool).</li>
<li>Returns an array of the changes that were reverted.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">await</span> pda.revert(staging)
</code></pre>
<p>Output looks like:</p>
<pre><code class="lang-js">[
  {
    <span class="hljs-attr">change</span>: <span class="hljs-string">'add'</span> | <span class="hljs-string">'mod'</span> | <span class="hljs-string">'del'</span>
    type: <span class="hljs-string">'dir'</span> | <span class="hljs-string">'file'</span>
    path: <span class="hljs-built_in">String</span> (path <span class="hljs-keyword">of</span> the file)
  },
  ...
]
</code></pre>
<h2 id="lookup"><a href="#lookup" class="anchor"></a>Lookup</h2><h3 id="statarchive-name-cb"><a href="#statarchive-name-cb" class="anchor"></a>stat(archive, name[, cb])</h3><ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
<li><code>name</code> Entry name (string).</li>
<li>Returns a Hyperdrive Stat entry (object).</li>
<li>Throws NotFoundError</li>
</ul>
<pre><code class="lang-js"><span class="hljs-comment">// by name:</span>
<span class="hljs-keyword">var</span> st = <span class="hljs-keyword">await</span> pda.stat(archive, <span class="hljs-string">'/dat.json'</span>)
st.isDirectory()
st.isFile()
<span class="hljs-built_in">console</span>.log(st) <span class="hljs-comment">/* =&gt;
Stat {
  dev: 0,
  nlink: 1,
  rdev: 0,
  blksize: 0,
  ino: 0,
  mode: 16877,
  uid: 0,
  gid: 0,
  size: 0,
  offset: 0,
  blocks: 0,
  atime: 2017-04-10T18:59:00.147Z,
  mtime: 2017-04-10T18:59:00.147Z,
  ctime: 2017-04-10T18:59:00.147Z,
  linkname: undefined } */</span>
</code></pre>
<h2 id="read"><a href="#read" class="anchor"></a>Read</h2><h3 id="readfilearchive-name-opts-cb"><a href="#readfilearchive-name-opts-cb" class="anchor"></a>readFile(archive, name[, opts, cb])</h3><ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
<li><code>name</code> Entry path (string).</li>
<li><code>opts</code>. Options (object|string). If a string, will act as <code>opts.encoding</code>.</li>
<li><code>opts.encoding</code> Desired output encoding (string). May be &#39;binary&#39;, &#39;utf8&#39;, &#39;hex&#39;, or &#39;base64&#39;. Default &#39;utf8&#39;.</li>
<li>Returns the content of the file in the requested encoding.</li>
<li>Throws NotFoundError, NotAFileError.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> manifestStr = <span class="hljs-keyword">await</span> pda.readFile(archive, <span class="hljs-string">'/dat.json'</span>)
<span class="hljs-keyword">var</span> imageBase64 = <span class="hljs-keyword">await</span> pda.readFile(archive, <span class="hljs-string">'/favicon.png'</span>, <span class="hljs-string">'base64'</span>)
</code></pre>
<h3 id="readdirarchive-path-opts-cb"><a href="#readdirarchive-path-opts-cb" class="anchor"></a>readdir(archive, path[, opts, cb])</h3><ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
<li><code>path</code> Target directory path (string).</li>
<li><code>opts.recursive</code> Read all subfolders and their files as well?</li>
<li>Returns an array of file and folder names.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> listing = <span class="hljs-keyword">await</span> pda.readdir(archive, <span class="hljs-string">'/assets'</span>)
<span class="hljs-built_in">console</span>.log(listing) <span class="hljs-comment">// =&gt; ['profile.png', 'styles.css']</span>

<span class="hljs-keyword">var</span> listing = <span class="hljs-keyword">await</span> pda.readdir(archive, <span class="hljs-string">'/'</span>, { <span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span> })
<span class="hljs-built_in">console</span>.log(listing) <span class="hljs-comment">/* =&gt; [
  'index.html',
  'assets',
  'assets/profile.png',
  'assets/styles.css'
]*/</span>
</code></pre>
<h2 id="write"><a href="#write" class="anchor"></a>Write</h2><h3 id="writefilearchive-name-data-opts-cb"><a href="#writefilearchive-name-data-opts-cb" class="anchor"></a>writeFile(archive, name, data[, opts, cb])</h3><ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
<li><code>name</code> Entry path (string).</li>
<li><code>data</code> Data to write (string|Buffer).</li>
<li><code>opts</code>. Options (object|string). If a string, will act as <code>opts.encoding</code>.</li>
<li><code>opts.encoding</code> Desired file encoding (string). May be &#39;binary&#39;, &#39;utf8&#39;, &#39;hex&#39;, or &#39;base64&#39;. Default &#39;utf8&#39; if <code>data</code> is a string, &#39;binary&#39; if <code>data</code> is a Buffer.</li>
<li>Throws ArchiveNotWritableError, InvalidPathError, EntryAlreadyExistsError, ParentFolderDoesntExistError, InvalidEncodingError.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">await</span> pda.writeFile(archive, <span class="hljs-string">'/hello.txt'</span>, <span class="hljs-string">'world'</span>, <span class="hljs-string">'utf8'</span>)
<span class="hljs-keyword">await</span> pda.writeFile(archive, <span class="hljs-string">'/profile.png'</span>, fs.readFileSync(<span class="hljs-string">'/tmp/dog.png'</span>))
</code></pre>
<h3 id="mkdirarchive-name-cb"><a href="#mkdirarchive-name-cb" class="anchor"></a>mkdir(archive, name[, cb])</h3><ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
<li><code>name</code> Directory path (string).</li>
<li>Throws ArchiveNotWritableError, InvalidPathError, EntryAlreadyExistsError, ParentFolderDoesntExistError, InvalidEncodingError.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">await</span> pda.mkdir(archive, <span class="hljs-string">'/stuff'</span>)
</code></pre>
<h3 id="copyarchive-sourcename-targetname-cb"><a href="#copyarchive-sourcename-targetname-cb" class="anchor"></a>copy(archive, sourceName, targetName[, cb])</h3><ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
<li><code>sourceName</code> Path to file or directory to copy (string).</li>
<li><code>targetName</code> Where to copy the file or folder to (string).</li>
<li>Throws ArchiveNotWritableError, InvalidPathError, EntryAlreadyExistsError, ParentFolderDoesntExistError, InvalidEncodingError.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-comment">// copy file:</span>
<span class="hljs-keyword">await</span> pda.copy(archive, <span class="hljs-string">'/foo.txt'</span>, <span class="hljs-string">'/foo.txt.back'</span>)
<span class="hljs-comment">// copy folder:</span>
<span class="hljs-keyword">await</span> pda.copy(archive, <span class="hljs-string">'/stuff'</span>, <span class="hljs-string">'/stuff-copy'</span>)
</code></pre>
<h3 id="renamearchive-sourcename-targetname-cb"><a href="#renamearchive-sourcename-targetname-cb" class="anchor"></a>rename(archive, sourceName, targetName[, cb])</h3><ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
<li><code>sourceName</code> Path to file or directory to rename (string).</li>
<li><code>targetName</code> What the file or folder should be named (string).</li>
<li>Throws ArchiveNotWritableError, InvalidPathError, EntryAlreadyExistsError, ParentFolderDoesntExistError, InvalidEncodingError.</li>
</ul>
<p>This is equivalent to moving a file/folder.</p>
<pre><code class="lang-js"><span class="hljs-comment">// move file:</span>
<span class="hljs-keyword">await</span> pda.copy(archive, <span class="hljs-string">'/foo.txt'</span>, <span class="hljs-string">'/foo.md'</span>)
<span class="hljs-comment">// move folder:</span>
<span class="hljs-keyword">await</span> pda.rename(archive, <span class="hljs-string">'/stuff'</span>, <span class="hljs-string">'/things'</span>)
</code></pre>
<h2 id="delete"><a href="#delete" class="anchor"></a>Delete</h2><h3 id="unlinkarchive-name-cb"><a href="#unlinkarchive-name-cb" class="anchor"></a>unlink(archive, name[, cb])</h3><ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
<li><code>name</code> Entry path (string).</li>
<li>Throws ArchiveNotWritableError, NotFoundError, NotAFileError</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">await</span> pda.unlink(archive, <span class="hljs-string">'/hello.txt'</span>)
</code></pre>
<h3 id="rmdirarchive-name-opts-cb"><a href="#rmdirarchive-name-opts-cb" class="anchor"></a>rmdir(archive, name[, opts, cb])</h3><ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
<li><code>name</code> Entry path (string).</li>
<li><code>opts.recursive</code> Delete all subfolders and files if the directory is not empty.</li>
<li>Throws ArchiveNotWritableError, NotFoundError, NotAFolderError, DestDirectoryNotEmpty</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">await</span> pda.rmdir(archive, <span class="hljs-string">'/stuff'</span>, {<span class="hljs-attr">recursive</span>: <span class="hljs-literal">true</span>})
</code></pre>
<h2 id="network"><a href="#network" class="anchor"></a>Network</h2><h3 id="downloadarchive-name-cb"><a href="#downloadarchive-name-cb" class="anchor"></a>download(archive, name[, cb])</h3><ul>
<li><code>archive</code> Hyperdrive archive (object). Can not be a staging object.</li>
<li><code>name</code> Entry path (string). Can point to a file or folder.</li>
</ul>
<p>Download an archive file or folder-tree.</p>
<pre><code class="lang-js"><span class="hljs-comment">// download a specific file:</span>
<span class="hljs-keyword">await</span> pda.download(archive, <span class="hljs-string">'/foo.txt'</span>)
<span class="hljs-comment">// download a specific folder and all children:</span>
<span class="hljs-keyword">await</span> pda.download(archive, <span class="hljs-string">'/bar/'</span>)
<span class="hljs-comment">// download the entire archive:</span>
<span class="hljs-keyword">await</span> pda.download(archive, <span class="hljs-string">'/'</span>)
</code></pre>
<h2 id="activity-streams"><a href="#activity-streams" class="anchor"></a>Activity Streams</h2><h3 id="createfileactivitystreamarchive-staging-path"><a href="#createfileactivitystreamarchive-staging-path" class="anchor"></a>createFileActivityStream(archive[, staging, path])</h3><ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
<li><code>staging</code> HyperdriveStagingArea instance (object).</li>
<li><code>path</code> Entry path (string) or <a href="npm.im/anymatch">anymatch</a> pattern (array of strings). If falsy, will watch all files.</li>
<li>Returns a Readable stream.</li>
</ul>
<p>Watches the given path or path-pattern for file events, which it emits as an <a href="https://github.com/substack/emit-stream">emit-stream</a>. Supported events:</p>
<ul>
<li><code>[&#39;changed&#39;,{path}]</code> - The contents of the file has changed, either by a local write or a remote write. The new content will be ready when this event is emitted. <code>path</code> is the path-string of the file.</li>
<li><code>[&#39;invalidated&#39;,{path}]</code> - The contents of the file has changed remotely, but hasn&#39;t been downloaded yet. <code>path</code> is the path-string of the file.</li>
</ul>
<p>An archive will emit &quot;invalidated&quot; first, when it receives the new metadata for the file. It will then emit &quot;changed&quot; when the content arrives. (A local archive will not emit &quot;invalidated.&quot;)</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> es = pda.createFileActivityStream(archive)
<span class="hljs-keyword">var</span> es = pda.createFileActivityStream(archive, <span class="hljs-string">'foo.txt'</span>)
<span class="hljs-keyword">var</span> es = pda.createFileActivityStream(archive, [<span class="hljs-string">'**/*.txt'</span>, <span class="hljs-string">'**/*.md'</span>])

es.on(<span class="hljs-string">'data'</span>, ([event, args]) =&gt; {
  <span class="hljs-keyword">if</span> (event === <span class="hljs-string">'invalidated'</span>) {
    <span class="hljs-built_in">console</span>.log(args.path, <span class="hljs-string">'has been invalidated'</span>)
    pda.download(archive, args.path)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event === <span class="hljs-string">'changed'</span>) {
    <span class="hljs-built_in">console</span>.log(args.path, <span class="hljs-string">'has changed'</span>)
  }
})

<span class="hljs-comment">// alternatively, via emit-stream:</span>

<span class="hljs-keyword">var</span> emitStream = <span class="hljs-built_in">require</span>(<span class="hljs-string">'emit-stream'</span>)
<span class="hljs-keyword">var</span> events = emitStream(es)
events.on(<span class="hljs-string">'invalidated'</span>, args =&gt; {
  <span class="hljs-built_in">console</span>.log(args.path, <span class="hljs-string">'has been invalidated'</span>)
  pda.download(archive, args.path)
})
events.on(<span class="hljs-string">'changed'</span>, args =&gt; {
  <span class="hljs-built_in">console</span>.log(args.path, <span class="hljs-string">'has changed'</span>)
})
</code></pre>
<h3 id="createnetworkactivitystreamarchive"><a href="#createnetworkactivitystreamarchive" class="anchor"></a>createNetworkActivityStream(archive)</h3><ul>
<li><code>archive</code> Hyperdrive archive (object). Can not be a staging object.</li>
<li>Returns a Readable stream.</li>
</ul>
<p>Watches the archive for network events, which it emits as an <a href="https://github.com/substack/emit-stream">emit-stream</a>. Supported events:</p>
<ul>
<li><code>[&#39;network-changed&#39;,{connections}]</code> - The number of connections has changed. <code>connections</code> is a number.</li>
<li><code>[&#39;download&#39;,{feed,block,bytes}]</code> - A block has been downloaded. <code>feed</code> will either be &quot;metadata&quot; or &quot;content&quot;. <code>block</code> is the index of data downloaded. <code>bytes</code> is the number of bytes in the block.</li>
<li><code>[&#39;upload&#39;,{feed,block,bytes}]</code> - A block has been uploaded. <code>feed</code> will either be &quot;metadata&quot; or &quot;content&quot;. <code>block</code> is the index of data downloaded. <code>bytes</code> is the number of bytes in the block.</li>
<li><code>[&#39;sync&#39;,{feed}]</code> - All known blocks have been downloaded. <code>feed</code> will either be &quot;metadata&quot; or &quot;content&quot;.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> es = pda.createNetworkActivityStream(archive)

es.on(<span class="hljs-string">'data'</span>, ([event, args]) =&gt; {
  <span class="hljs-keyword">if</span> (event === <span class="hljs-string">'network-changed'</span>) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Connected to %d peers'</span>, args.connections)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event === <span class="hljs-string">'download'</span>) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Just downloaded %d bytes (block %d) of the %s feed'</span>, args.bytes, args.block, args.feed)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event === <span class="hljs-string">'upload'</span>) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Just uploaded %d bytes (block %d) of the %s feed'</span>, args.bytes, args.block, args.feed)
  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event === <span class="hljs-string">'sync'</span>) {
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Finished downloading'</span>, args.feed)
  }
})

<span class="hljs-comment">// alternatively, via emit-stream:</span>

<span class="hljs-keyword">var</span> emitStream = <span class="hljs-built_in">require</span>(<span class="hljs-string">'emit-stream'</span>)
<span class="hljs-keyword">var</span> events = emitStream(es)
events.on(<span class="hljs-string">'network-changed'</span>, args =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Connected to %d peers'</span>, args.connections)
})
events.on(<span class="hljs-string">'download'</span>, args =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Just downloaded %d bytes (block %d) of the %s feed'</span>, args.bytes, args.block, args.feed)
})
events.on(<span class="hljs-string">'upload'</span>, args =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Just uploaded %d bytes (block %d) of the %s feed'</span>, args.bytes, args.block, args.feed)
})
events.on(<span class="hljs-string">'sync'</span>, args =&gt; {
  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Finished downloading'</span>, args.feed)
})
</code></pre>
<h2 id="exporters"><a href="#exporters" class="anchor"></a>Exporters</h2><h3 id="exportfilesystemtoarchiveopts-cb"><a href="#exportfilesystemtoarchiveopts-cb" class="anchor"></a>exportFilesystemToArchive(opts[, cb])</h3><ul>
<li><code>opts.srcPath</code> Source path in the filesystem (string). Required.</li>
<li><code>opts.dstArchive</code> Destination archive (object). Required.</li>
<li><code>opts.dstPath</code> Destination path within the archive. Optional, defaults to &#39;/&#39;.</li>
<li><code>opts.ignore</code> Files not to copy (array of strings). Optional. Uses <a href="npm.im/anymatch">anymatch</a>.</li>
<li><code>opts.inplaceImport</code> Should import source directory in-place? (boolean). If true and importing a directory, this will cause the directory&#39;s content to be copied directy into the <code>dstPath</code>. If false, will cause the source-directory to become a child of the <code>dstPath</code>.</li>
<li><code>opts.dryRun</code> Don&#39;t actually copy (boolean). If true, will run all export logic without actually modifying the target archive.</li>
<li>Returns stats on the export.</li>
</ul>
<p>Copies a file-tree into an archive.</p>
<p>The <code>dryRun</code> opt is useful because this method compares the source files to the destination before copying. Therefore the stats returned by a dry run gives you a file-level diff.</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> stats = <span class="hljs-keyword">await</span> pda.exportFilesystemToArchive({
  <span class="hljs-attr">srcPath</span>: <span class="hljs-string">'/tmp/mystuff'</span>,
  <span class="hljs-attr">dstArchive</span>: archive,
  <span class="hljs-attr">inplaceImport</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-built_in">console</span>.log(stats) <span class="hljs-comment">/* =&gt; {
  addedFiles: ['fuzz.txt', 'foo/bar.txt'],
  updatedFiles: ['something.txt'],
  skipCount: 3, // files skipped due to the target already existing
  fileCount: 3,
  totalSize: 400 // bytes
}*/</span>
</code></pre>
<h3 id="exportarchivetofilesystemopts-cb"><a href="#exportarchivetofilesystemopts-cb" class="anchor"></a>exportArchiveToFilesystem(opts[, cb])</h3><ul>
<li><code>opts.srcArchive</code> Source archive (object). Required.</li>
<li><code>opts.dstPath</code> Destination path in the filesystem (string). Required.</li>
<li><code>opts.srcPath</code> Source path within the archive. Optional, defaults to &#39;/&#39;.</li>
<li><code>opts.ignore</code> Files not to copy (array of strings). Optional. Uses <a href="npm.im/anymatch">anymatch</a>.</li>
<li><code>opts.overwriteExisting</code> Proceed if the destination isn&#39;t empty (boolean). Default false.</li>
<li><code>opts.skipUndownloadedFiles</code> Ignore files that haven&#39;t been downloaded yet (boolean). Default false. If false, will wait for source files to download.</li>
<li>Returns stats on the export.</li>
</ul>
<p>Copies an archive into the filesystem.</p>
<p>NOTE</p>
<ul>
<li>Unlike exportFilesystemToArchive, this will not compare the target for equality before copying. If <code>overwriteExisting</code> is true, it will simply copy all files again.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> stats = <span class="hljs-keyword">await</span> pda.exportArchiveToFilesystem({
  <span class="hljs-attr">srcArchive</span>: archive,
  <span class="hljs-attr">dstPath</span>: <span class="hljs-string">'/tmp/mystuff'</span>,
  <span class="hljs-attr">skipUndownloadedFiles</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-built_in">console</span>.log(stats) <span class="hljs-comment">/* =&gt; {
  addedFiles: ['fuzz.txt', 'foo/bar.txt'],
  updatedFiles: ['something.txt'],
  fileCount: 3,
  totalSize: 400 // bytes
}*/</span>
</code></pre>
<h3 id="exportarchivetoarchiveopts-cb"><a href="#exportarchivetoarchiveopts-cb" class="anchor"></a>exportArchiveToArchive(opts[, cb])</h3><ul>
<li><code>opts.srcArchive</code> Source archive (object). Required.</li>
<li><code>opts.dstArchive</code> Destination archive (object). Required.</li>
<li><code>opts.srcPath</code> Source path within the source archive (string). Optional, defaults to &#39;/&#39;.</li>
<li><code>opts.dstPath</code> Destination path within the destination archive (string). Optional, defaults to &#39;/&#39;.</li>
<li><code>opts.ignore</code> Files not to copy (array of strings). Optional. Uses <a href="npm.im/anymatch">anymatch</a>.</li>
<li><code>opts.skipUndownloadedFiles</code> Ignore files that haven&#39;t been downloaded yet (boolean). Default false. If false, will wait for source files to download.</li>
</ul>
<p>Copies an archive into another archive.</p>
<p>NOTE</p>
<ul>
<li>Unlike exportFilesystemToArchive, this will not compare the target for equality before copying. It copies files indescriminately.</li>
</ul>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> stats = <span class="hljs-keyword">await</span> pda.exportArchiveToArchive({
  <span class="hljs-attr">srcArchive</span>: archiveA,
  <span class="hljs-attr">dstArchive</span>: archiveB,
  <span class="hljs-attr">skipUndownloadedFiles</span>: <span class="hljs-literal">true</span>
})
<span class="hljs-built_in">console</span>.log(stats) <span class="hljs-comment">/* =&gt; {
  addedFiles: ['fuzz.txt', 'foo/bar.txt'],
  updatedFiles: ['something.txt'],
  fileCount: 3,
  totalSize: 400 // bytes
}*/</span>
</code></pre>
<h2 id="manifest"><a href="#manifest" class="anchor"></a>Manifest</h2><h3 id="readmanifestarchive-cb"><a href="#readmanifestarchive-cb" class="anchor"></a>readManifest(archive[, cb])</h3><ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
</ul>
<p>A sugar to get the manifest object.</p>
<pre><code class="lang-js"><span class="hljs-keyword">var</span> manifestObj = <span class="hljs-keyword">await</span> pda.readManifest(archive)
</code></pre>
<h3 id="writemanifestarchive-manifest-cb"><a href="#writemanifestarchive-manifest-cb" class="anchor"></a>writeManifest(archive, manifest[, cb])</h3><ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
<li><code>manifest</code> Manifest values (object).</li>
</ul>
<p>A sugar to write the manifest object.</p>
<pre><code class="lang-js"><span class="hljs-keyword">await</span> pda.writeManifest(archive, { <span class="hljs-attr">title</span>: <span class="hljs-string">'My dat!'</span> })
</code></pre>
<h3 id="updatemanifestarchive-manifest-cb"><a href="#updatemanifestarchive-manifest-cb" class="anchor"></a>updateManifest(archive, manifest[, cb])</h3><ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
<li><code>manifest</code> Manifest values (object).</li>
</ul>
<p>A sugar to modify the manifest object.</p>
<pre><code class="lang-js"><span class="hljs-keyword">await</span> pda.writeManifest(archive, { <span class="hljs-attr">title</span>: <span class="hljs-string">'My dat!'</span>, <span class="hljs-attr">description</span>: <span class="hljs-string">'the desc'</span> })
<span class="hljs-keyword">await</span> pda.writeManifest(archive, { <span class="hljs-attr">title</span>: <span class="hljs-string">'My new title!'</span> }) <span class="hljs-comment">// preserves description</span>
</code></pre>
<h3 id="generatemanifestopts"><a href="#generatemanifestopts" class="anchor"></a>generateManifest(opts)</h3><ul>
<li><code>opts</code> Manifest options (object).</li>
</ul>
<p>Helper to generate a manifest object. Opts in detail:</p>
<pre><code>{
  url: <span class="hljs-built_in">String</span>, the dat<span class="hljs-symbol">'s</span> url
  title: <span class="hljs-built_in">String</span>
  description: <span class="hljs-built_in">String</span>
  author: <span class="hljs-built_in">String</span>
  version: <span class="hljs-built_in">String</span>
  forkOf: <span class="hljs-built_in">String</span>, the forked-from dat<span class="hljs-symbol">'s</span> url
  createdBy: <span class="hljs-built_in">String</span>, the url of the app that created the dat
}
</code></pre><p>See: <a href="https://github.com/datprotocol/dat.json">https://github.com/datprotocol/dat.json</a></p>
<h2 id="helpers"><a href="#helpers" class="anchor"></a>Helpers</h2><h3 id="findentrybycontentblockarchive-block"><a href="#findentrybycontentblockarchive-block" class="anchor"></a>findEntryByContentBlock(archive, block)</h3><ul>
<li><code>archive</code> Hyperdrive archive (object).</li>
<li><code>block</code> Content-block index</li>
<li>Returns a Promise for <code>{name:, start:, end:}</code></li>
</ul>
<p>Runs a binary search to find the file-entry that the given content-block index belongs to.</p>
<pre><code class="lang-js"><span class="hljs-keyword">await</span> pda.findEntryByContentBlock(archive, <span class="hljs-number">5</span>)
<span class="hljs-comment">/* =&gt; {
  name: '/foo.txt',
  start: 4,
  end: 6
}*/</span>
</code></pre>
</div>
  </div>
        </div>
      </main>
    </div>
<script src="/bundle.js"></script>
</body>
</html>
