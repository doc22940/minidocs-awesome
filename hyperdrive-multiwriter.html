<!doctype html>
<html lang="en" dir="ltr">
<head>
<title>Awesome Dat</title>
<meta charset="utf-8">

<link rel="stylesheet" href="/bundle.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/style.css">
</head>
<body>
<div id="choo-root" class="_d4e87350 minidocs flex flex-column m0 h-100">
      <div class="minidocs-header-flex flex">
        <header class="_19f2d18a minidocs-header ph4 w-100 bg-black-90">
    <nav class="flex justify-between">
      <div class="flex items-center">
        <div class="menu-button">
          <a class=" menu-toggle"></a>
        </div>
        <a href="/" title="Awesome Dat" class="inline-flex items-center">
        <img src="/dat-data-logo.svg" alt="Awesome Dat" class="minidocs-header-logo dib w2 h2" />
        <span class="minidocs-header-title ml2 pr2 white">Awesome Dat</span>
      </a>
      </div>
      <div class="minidocs-header-nav flex-grow flex items-center tr ttu">
        <a href="/install" title="Install" class="minidocs-header-link white dim link dn dib-ns mr3-ns">Install</a>
        <a href="http://datproject.org/" title="Home" class="minidocs-header-link white dim link dib mr3-ns">Home</a>
      </div>
    </nav>
  </header>
      </div>
      <main class="minidocs-main-flex flex">
        <div class="minidocs-sidebar-flex open order-0 overflow-auto bg-near-white">
        <div class="_068b628f minidocs-menu pa3">
      <div class="f3 pt2">Welcome</div><div><a href="/awesome-dat" class="content-link ">Awesome Dat</a></div><div class="f3 pt2">Dat Applications</div><div><a href="/dat" class="content-link ">datproject/dat</a></div><div><a href="/dat-desktop" class="content-link ">datproject/dat-desktop</a></div><div class="f3 pt2">Community Applications</div><div><a href="/sciencefair" class="content-link ">codeforscience/sciencefair</a></div><div><a href="/hyperirc" class="content-link ">mafintosh/hyperirc</a></div><div><a href="/soundcloud-archiver" class="content-link ">jondashkyle/soundcloud-archiver</a></div><div><a href="/hypervision" class="content-link ">mafintosh/hypervision</a></div><div><a href="/hypertweet" class="content-link ">joehand/hypertweet</a></div><div><a href="/dat-photos-app" class="content-link ">beakerbrowser/dat-photos-app</a></div><div class="f3 pt2">High-Level APIs</div><div><a href="/dat-node" class="content-link ">datproject/dat-node</a></div><div><a href="/dat-js" class="content-link ">datproject/dat-js</a></div><div><a href="/pauls-dat-api" class="content-link ">beakerbrowser/pauls-dat-api</a></div><div><a href="/node-dat-archive" class="content-link ">beakerbrowser/node-dat-archive</a></div><div class="f3 pt2">Hosting &amp; Dat Management</div><div><a href="/hypercore-archiver" class="content-link ">mafintosh/hypercore-archiver</a></div><div><a href="/hypercloud" class="content-link ">datprotocol/hypercloud</a></div><div><a href="/hashbase" class="content-link ">beakerbrowser/hashbase</a></div><div><a href="/dat-now" class="content-link ">joehand/dat-now</a></div><div><a href="/hypercore-archiver-bot" class="content-link ">mafintosh/hypercore-archiver-bot</a></div><div><a href="/hypercore-archiver-ws" class="content-link ">joehand/hypercore-archiver-ws</a></div><div><a href="/dat-registry-api" class="content-link ">datproject/dat-registry-api</a></div><div><a href="/dat-registry-client" class="content-link ">datproject/dat-registry-client</a></div><div class="f3 pt2">Managing &amp; Aggregating Dats</div><div><a href="/multidat" class="content-link ">datproject/multidat</a></div><div><a href="/multidrive" class="content-link ">datproject/multidrive</a></div><div><a href="/dat-pki" class="content-link ">jayrbolton/dat-pki</a></div><div><a href="/injestdb" class="content-link ">beakerbrowser/injestdb</a></div><div class="f3 pt2">Http Hosting</div><div><a href="/hyperdrive-http" class="content-link ">joehand/hyperdrive-http</a></div><div><a href="/dathttpd" class="content-link ">beakerbrowser/dathttpd</a></div><div class="f3 pt2">Dat Link Utilties</div><div><a href="/dat-dns" class="content-link ">datprotocol/dat-dns</a></div><div><a href="/dat-link-resolve" class="content-link ">joehand/dat-link-resolve</a></div><div><a href="/parse-dat-url" class="content-link ">pfrazee/parse-dat-url</a></div><div><a href="/dat-encoding" class="content-link ">juliangruber/dat-encoding</a></div><div class="f3 pt2">Dat Utilities</div><div><a href="/dat-log" class="content-link ">joehand/dat-log</a></div><div><a href="/dat-ls" class="content-link ">mafintosh/dat-ls</a></div><div><a href="/hyperhealth" class="content-link ">karissa/hyperhealth</a></div><div><a href="/hyperdrive-network-speed" class="content-link ">joehand/hyperdrive-network-speed</a></div><div class="f3 pt2">File Imports &amp; Exports</div><div><a href="/hyperdrive-import-files" class="content-link ">juliangruber/hyperdrive-import-files</a></div><div><a href="/mirror-folder" class="content-link ">mafintosh/mirror-folder</a></div><div><a href="/hyperdrive-staging-area" class="content-link ">pfrazee/hyperdrive-staging-area</a></div><div><a href="/hyperdrive-to-zip-stream" class="content-link ">pfrazee/hyperdrive-to-zip-stream</a></div><div class="f3 pt2">Hypercore Tools</div><div><a href="/hyperpipe" class="content-link ">mafintosh/hyperpipe</a></div><div class="f3 pt2">Dat Core Modules</div><div><a href="/hyperdrive" class="content-link ">mafintosh/hyperdrive</a></div><div><a href="/hypercore" class="content-link ">mafintosh/hypercore</a></div><div class="f3 pt2">CLI Utilities</div><div><a href="/dat-doctor" class="content-link ">joehand/dat-doctor</a></div><div><a href="/dat-ignore" class="content-link ">joehand/dat-ignore</a></div><div><a href="/dat-json" class="content-link ">joehand/dat-json</a></div><div class="f3 pt2">Networking</div><div><a href="/hyperdiscovery" class="content-link ">karissa/hyperdiscovery</a></div><div><a href="/discovery-swarm" class="content-link ">mafintosh/discovery-swarm</a></div><div><a href="/webrtc-swarm" class="content-link ">mafintosh/webrtc-swarm</a></div><div><a href="/dat-swarm-defaults" class="content-link ">joehand/dat-swarm-defaults</a></div><div class="f3 pt2">Lower level networking modules</div><div><a href="/discovery-channel" class="content-link ">maxogden/discovery-channel</a></div><div><a href="/dns-discovery" class="content-link ">mafintosh/dns-discovery</a></div><div><a href="/multicast-dns" class="content-link ">mafintosh/multicast-dns</a></div><div><a href="/bittorrent-dht" class="content-link ">webtorrent/bittorrent-dht</a></div><div><a href="/utp-native" class="content-link ">mafintosh/utp-native</a></div><div><a href="/signalhub" class="content-link ">mafintosh/signalhub</a></div><div class="f3 pt2">Storage</div><div><a href="/dat-storage" class="content-link ">datproject/dat-storage</a></div><div><a href="/dat-secret-storage" class="content-link ">datproject/dat-secret-storage</a></div><div class="f3 pt2">Random Access</div><div><a href="/abstract-random-access" class="content-link ">juliangruber/abstract-random-access</a></div><div><a href="/multi-random-access" class="content-link ">mafintosh/multi-random-access</a></div><div><a href="/random-access-file" class="content-link ">mafintosh/random-access-file</a></div><div><a href="/random-access-memory" class="content-link ">mafintosh/random-access-memory</a></div><div><a href="/random-access-page-files" class="content-link ">mafintosh/random-access-page-files</a></div><div><a href="/dat-http" class="content-link ">datproject/dat-http</a></div><div><a href="/random-access-idb" class="content-link ">substack/random-access-idb</a></div><div class="f3 pt2">Other Related Dat Project Modules</div><div><a href="/peer-network" class="content-link ">mafintosh/peer-network</a></div><div><a href="/hyperdht" class="content-link ">mafintosh/hyperdht</a></div><div class="f3 pt2">Dat Project Organization Stuff</div><div><a href="/datproject.org" class="content-link ">datproject/datproject.org</a></div><div><a href="/discussions" class="content-link ">datproject/discussions</a></div><div><a href="/design" class="content-link ">datproject/design</a></div><div><a href="/dat-elements" class="content-link ">datproject/dat-elements</a></div><div><a href="/dat-colors" class="content-link ">kriesse/dat-colors</a></div><div><a href="/dat-icons" class="content-link ">kriesse/dat-icons</a></div><div><a href="/dat.json" class="content-link ">juliangruber/dat.json</a></div><div class="f3 pt2">Outdated</div><div><a href="/dat.haus" class="content-link ">juliangruber/dat.haus</a></div><div><a href="/hyperfeed" class="content-link ">poga/hyperfeed</a></div><div><a href="/normcore" class="content-link ">yoshuawuyts/normcore</a></div><div><a href="/github-to-hypercore" class="content-link ">yoshuawuyts/github-to-hypercore</a></div><div><a href="/hyperspark" class="content-link ">poga/hyperspark</a></div><div><a href="/hypercore-index" class="content-link ">juliangruber/hypercore-index</a></div><div><a href="/hyperdrive-encoding" class="content-link ">juliangruber/hyperdrive-encoding</a></div><div><a href="/hyperdrive-http-server" class="content-link ">mafintosh/hyperdrive-http-server</a></div><div><a href="/hyperdrive-http" class="content-link ">joehand/hyperdrive-http</a></div><div><a href="/dat-push" class="content-link ">joehand/dat-push</a></div><div><a href="/dat-backup" class="content-link ">joehand/dat-backup</a></div><div><a href="/archiver-server" class="content-link ">joehand/archiver-server</a></div><div><a href="/archiver-api" class="content-link ">joehand/archiver-api</a></div><div><a href="/hyperdrive-ln" class="content-link ">poga/hyperdrive-ln</a></div><div>
            <a href="/hyperdrive-multiwriter" class="content-link active">substack/hyperdrive-multiwriter</a>
            <div class="minidocs-menu-toc">
              <a href="#var-mdrive-multidriveopts" class="f5 content-link">var mdrive = multidrive(opts)</a><a href="#var-r-mdrivelistopts-cb" class="f5 content-link">var r = mdrive.list(opts, cb)</a><a href="#var-w-mdrivecreatefilewritestreamentry" class="f5 content-link">var w = mdrive.createFileWriteStream(entry)</a><a href="#var-r-mdrivecreatefilereadstreamentry" class="f5 content-link">var r = mdrive.createFileReadStream(entry)</a><a href="#mdriveappendentry-cb" class="f5 content-link">mdrive.append(entry, cb)</a><a href="#mdrivegetentry-opts-cb" class="f5 content-link">mdrive.get(entry, opts, cb)</a><a href="#mdrivedownloadentry-opts-cb" class="f5 content-link">mdrive.download(entry, opts, cb)</a><a href="#mdriveclosecb" class="f5 content-link">mdrive.close(cb)</a><a href="#var-cursor-mdrivecreatebytecursorentry" class="f5 content-link">var cursor = mdrive.createByteCursor(entry)</a><a href="#var-stream-mdrivereplicate" class="f5 content-link">var stream = mdrive.replicate()</a><a href="#mdriveunreplicatestream" class="f5 content-link">mdrive.unreplicate(stream)</a>
            </div>
          </div><div><a href="/hyperdrive-named-archives" class="content-link ">substack/hyperdrive-named-archives</a></div><div><a href="/git-dat" class="content-link ">substack/git-dat</a></div><div><a href="/jawn" class="content-link ">CfABrigadePhiladelphia/jawn</a></div><div><a href="/dat-archiver" class="content-link ">maxogden/dat-archiver</a></div><div><a href="/hyperdrive-stats" class="content-link ">juliangruber/hyperdrive-stats</a></div><div><a href="/hypercore-stats-server" class="content-link ">karissa/hypercore-stats-server</a></div><div><a href="/hypercore-stats-ui" class="content-link ">mafintosh/hypercore-stats-ui</a></div><div><a href="/zip-to-hyperdrive" class="content-link ">karissa/zip-to-hyperdrive</a></div><div><a href="/url-dat" class="content-link ">joehand/url-dat</a></div><div><a href="/tar-dat" class="content-link ">joehand/tar-dat</a></div><div><a href="/hyperdrive-duplicate" class="content-link ">joehand/hyperdrive-duplicate</a></div>
    </div>
      </div>
        <div id="minidocs-content" class="minidocs-content-flex order-1 overflow-auto">
          <div class="_32076d68 pa3 ph5-ns pv4-ns">
    
    
    <div><h1 id="hyperdrive-multiwriter"><a href="#hyperdrive-multiwriter" class="anchor"></a>hyperdrive-multiwriter</h1><p>present a bundle of hyperdrive archives together as a multi-writer view</p>
<p>This module create a writable archive on each database and creates readable
archives for every other remote peer. The data from these archives are presented
as a single view, even though there are many archives behind the scenes.</p>
<h1 id="example"><a href="#example" class="anchor"></a>example</h1><pre><code class="lang-js"><span class="hljs-keyword">var</span> multidrive = <span class="hljs-built_in">require</span>(<span class="hljs-string">'hyperdrive-multiwriter'</span>)
<span class="hljs-keyword">var</span> hyperdrive = <span class="hljs-built_in">require</span>(<span class="hljs-string">'hyperdrive'</span>)
<span class="hljs-keyword">var</span> level = <span class="hljs-built_in">require</span>(<span class="hljs-string">'level'</span>)
<span class="hljs-keyword">var</span> sub = <span class="hljs-built_in">require</span>(<span class="hljs-string">'subleveldown'</span>)

<span class="hljs-keyword">var</span> db = level(process.argv[<span class="hljs-number">2</span>])
<span class="hljs-keyword">var</span> mdrive = multidrive({
  <span class="hljs-attr">db</span>: db,
  <span class="hljs-attr">drive</span>: hyperdrive(sub(db,<span class="hljs-string">'d'</span>))
})

<span class="hljs-keyword">if</span> (process.argv[<span class="hljs-number">3</span>] === <span class="hljs-string">'list'</span>) {
  mdrive.list(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, entries</span>) </span>{
    entries.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry</span>) </span>{
      <span class="hljs-built_in">console</span>.log(<span class="hljs-built_in">JSON</span>.stringify(entry))
    })
  })
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (process.argv[<span class="hljs-number">3</span>] === <span class="hljs-string">'read'</span>) {
  <span class="hljs-keyword">var</span> entry = <span class="hljs-built_in">JSON</span>.parse(process.argv[<span class="hljs-number">4</span>])
  mdrive.createFileReadStream(entry).pipe(process.stdout)
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (process.argv[<span class="hljs-number">3</span>] === <span class="hljs-string">'write'</span>) {
  process.stdin.pipe(mdrive.createFileWriteStream(process.argv[<span class="hljs-number">4</span>]))
} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (process.argv[<span class="hljs-number">3</span>] === <span class="hljs-string">'sync'</span>) {
  <span class="hljs-keyword">var</span> r = mdrive.replicate()
  process.stdin.pipe(r).pipe(process.stdout)
}
</code></pre>
<p>create some data:</p>
<pre><code class="lang-sh">$ <span class="hljs-built_in">echo</span> HI | node drive.js /tmp/a write hello.txt
$ <span class="hljs-built_in">echo</span> HOWDY | node drive.js /tmp/b write hello.txt
$ <span class="hljs-built_in">echo</span> WHATEVER | node drive.js /tmp/c write cool.txt
</code></pre>
<p>gossip replication (<code>npm install -g dupsh</code>):</p>
<pre><code class="lang-sh">$ dupsh <span class="hljs-string">'node drive.js /tmp/a sync'</span> <span class="hljs-string">'node drive.js /tmp/b sync'</span>
^C
$ dupsh <span class="hljs-string">'node drive.js /tmp/b sync'</span> <span class="hljs-string">'node drive.js /tmp/c sync'</span>
^C
$ dupsh <span class="hljs-string">'node drive.js /tmp/a sync'</span> <span class="hljs-string">'node drive.js /tmp/b sync'</span>
^C
</code></pre>
<p>now each node has all the data:</p>
<pre><code class="lang-sh">$ node drive.js /tmp/a list
{<span class="hljs-string">"name"</span>:<span class="hljs-string">"hello.txt"</span>,<span class="hljs-string">"linkname"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"length"</span>:3,<span class="hljs-string">"blocks"</span>:1,<span class="hljs-string">"mode"</span>:0,<span class="hljs-string">"uid"</span>:0,<span class="hljs-string">"gid"</span>:0,<span class="hljs-string">"mtime"</span>:0,<span class="hljs-string">"ctime"</span>:0,<span class="hljs-string">"content"</span>:{<span class="hljs-string">"blockOffset"</span>:0,<span class="hljs-string">"bytesOffset"</span>:0},<span class="hljs-string">"type"</span>:<span class="hljs-string">"file"</span>,<span class="hljs-string">"link"</span>:<span class="hljs-string">"a9310f51ee8e9e4bc805866b1ae0bf3d94be055843b1f4f3d55ea275946f1dcb"</span>}
{<span class="hljs-string">"name"</span>:<span class="hljs-string">"cool.txt"</span>,<span class="hljs-string">"linkname"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"length"</span>:9,<span class="hljs-string">"blocks"</span>:1,<span class="hljs-string">"mode"</span>:0,<span class="hljs-string">"uid"</span>:0,<span class="hljs-string">"gid"</span>:0,<span class="hljs-string">"mtime"</span>:0,<span class="hljs-string">"ctime"</span>:0,<span class="hljs-string">"content"</span>:{<span class="hljs-string">"blockOffset"</span>:0,<span class="hljs-string">"bytesOffset"</span>:0},<span class="hljs-string">"type"</span>:<span class="hljs-string">"file"</span>,<span class="hljs-string">"link"</span>:<span class="hljs-string">"c34e0d868ae6371dff499733befe5213f9cf1573a4bb14eb4eb105f2a7408860"</span>}
{<span class="hljs-string">"name"</span>:<span class="hljs-string">"hello.txt"</span>,<span class="hljs-string">"linkname"</span>:<span class="hljs-string">""</span>,<span class="hljs-string">"length"</span>:6,<span class="hljs-string">"blocks"</span>:1,<span class="hljs-string">"mode"</span>:0,<span class="hljs-string">"uid"</span>:0,<span class="hljs-string">"gid"</span>:0,<span class="hljs-string">"mtime"</span>:0,<span class="hljs-string">"ctime"</span>:0,<span class="hljs-string">"content"</span>:{<span class="hljs-string">"blockOffset"</span>:0,<span class="hljs-string">"bytesOffset"</span>:0},<span class="hljs-string">"type"</span>:<span class="hljs-string">"file"</span>,<span class="hljs-string">"link"</span>:<span class="hljs-string">"d4934913d24da13f9ede9e56ccf71f769db29252b95cab59ea08e7cd6ea845ce"</span>}
$ node drive.js /tmp/a <span class="hljs-built_in">read</span> <span class="hljs-string">'{"name":"cool.txt","link":"c34e0d868ae6371dff499733befe5213f9cf1573a4bb14eb4eb105f2a7408860"}'</span>
WHATEVER
</code></pre>
<h1 id="api"><a href="#api" class="anchor"></a>api</h1><pre><code class="lang-js"><span class="hljs-keyword">var</span> multidrive = <span class="hljs-built_in">require</span>(<span class="hljs-string">'hyperdrive-multiwriter'</span>)
</code></pre>
<h2 id="var-mdrive-multidriveopts"><a href="#var-mdrive-multidriveopts" class="anchor"></a>var mdrive = multidrive(opts)</h2><p>Create a multi-writer hyperdrive instance <code>mdrive</code> from <code>opts</code>:</p>
<ul>
<li><code>opts.db</code> - levelup database</li>
<li><code>opts.drive</code> - hyperdrive instance</li>
</ul>
<p><code>mdrive</code> has most of the same methods as a hyperdrive archive instance.</p>
<p>The rest of the <code>opts</code> are passed through to <code>drive.createArchive(opts)</code>.</p>
<h2 id="var-r-mdrivelistopts-cb"><a href="#var-r-mdrivelistopts-cb" class="anchor"></a>var r = mdrive.list(opts, cb)</h2><p>Return a readable stream <code>r</code> with entries from all the archives or collect all
the entries as <code>cb(err, entries)</code>.</p>
<p>Each entry has an <code>entry.link</code> hex string added to it to associate it with the
proper archive..</p>
<h2 id="var-w-mdrivecreatefilewritestreamentry"><a href="#var-w-mdrivecreatefilewritestreamentry" class="anchor"></a>var w = mdrive.createFileWriteStream(entry)</h2><p>Store data in the archive by writing to a writable stream <code>w</code>.</p>
<p><code>entry</code> should be an object or a string interpreted as <code>entry.name</code>.</p>
<h2 id="var-r-mdrivecreatefilereadstreamentry"><a href="#var-r-mdrivecreatefilereadstreamentry" class="anchor"></a>var r = mdrive.createFileReadStream(entry)</h2><p>Create a readable stream for the contents of <code>entry</code>.</p>
<p><code>entry</code> should have an <code>entry.link</code> and <code>entry.name</code>.</p>
<h2 id="mdriveappendentry-cb"><a href="#mdriveappendentry-cb" class="anchor"></a>mdrive.append(entry, cb)</h2><p>Append an entry into the writable archive.</p>
<h2 id="mdrivegetentry-opts-cb"><a href="#mdrivegetentry-opts-cb" class="anchor"></a>mdrive.get(entry, opts, cb)</h2><p>Read an entry from the archive as <code>cb(err, entry)</code>.</p>
<h2 id="mdrivedownloadentry-opts-cb"><a href="#mdrivedownloadentry-opts-cb" class="anchor"></a>mdrive.download(entry, opts, cb)</h2><p>Fully download a file/entry from the archive.</p>
<h2 id="mdriveclosecb"><a href="#mdriveclosecb" class="anchor"></a>mdrive.close(cb)</h2><p>Close all resources.</p>
<h2 id="var-cursor-mdrivecreatebytecursorentry"><a href="#var-cursor-mdrivecreatebytecursorentry" class="anchor"></a>var cursor = mdrive.createByteCursor(entry)</h2><p>Create a <code>cursor</code> that can seek and traverse <code>entry</code>.</p>
<h2 id="var-stream-mdrivereplicate"><a href="#var-stream-mdrivereplicate" class="anchor"></a>var stream = mdrive.replicate()</h2><p>Return a duplex <code>stream</code> for replication that multiplexes the replication
streams of all the underlying archives along with a coordinator channel to
create the required readable archives on both sides of the connection.</p>
<h2 id="mdriveunreplicatestream"><a href="#mdriveunreplicatestream" class="anchor"></a>mdrive.unreplicate(stream)</h2><p>Stop replicating a <code>stream</code>. If <code>stream</code> isn&#39;t given, stops all replication
stream on <code>mdrive</code>.</p>
<h1 id="install"><a href="#install" class="anchor"></a>install</h1><pre><code>npm <span class="hljs-keyword">install</span> hyperdrive-multiwriter
</code></pre><h1 id="license"><a href="#license" class="anchor"></a>license</h1><p>BSD</p>
</div>
  </div>
        </div>
      </main>
    </div>
<script src="/bundle.js"></script>
</body>
</html>
