<!doctype html>
<html lang="en" dir="ltr">
<head>
<title>Awesome Dat</title>
<meta charset="utf-8">

<link rel="stylesheet" href="/bundle.css">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/style.css">
</head>
<body>
<div id="choo-root" class="_d4e87350 minidocs flex flex-column m0 h-100">
      <div class="minidocs-header-flex flex">
        <header class="_19f2d18a minidocs-header ph4 w-100 bg-black-90">
    <nav class="flex justify-between">
      <div class="flex items-center">
        <div class="menu-button">
          <a class=" menu-toggle"></a>
        </div>
        <a href="/" title="Awesome Dat" class="inline-flex items-center">
        <img src="/dat-data-logo.svg" alt="Awesome Dat" class="minidocs-header-logo dib w2 h2" />
        <span class="minidocs-header-title ml2 pr2 white">Awesome Dat</span>
      </a>
      </div>
      <div class="minidocs-header-nav flex-grow flex items-center tr ttu">
        <a href="/install" title="Install" class="minidocs-header-link white dim link dn dib-ns mr3-ns">Install</a>
        <a href="http://datproject.org/" title="Home" class="minidocs-header-link white dim link dib mr3-ns">Home</a>
      </div>
    </nav>
  </header>
      </div>
      <main class="minidocs-main-flex flex">
        <div class="minidocs-sidebar-flex open order-0 overflow-auto bg-near-white">
        <div class="_068b628f minidocs-menu pa3">
      <div class="f3 pt2">Welcome</div><div><a href="/awesome-dat" class="content-link ">Awesome Dat</a></div><div class="f3 pt2">Dat Applications</div><div><a href="/dat" class="content-link ">datproject/dat</a></div><div><a href="/dat-desktop" class="content-link ">datproject/dat-desktop</a></div><div class="f3 pt2">Community Applications</div><div><a href="/sciencefair" class="content-link ">codeforscience/sciencefair</a></div><div><a href="/hyperirc" class="content-link ">mafintosh/hyperirc</a></div><div><a href="/soundcloud-archiver" class="content-link ">jondashkyle/soundcloud-archiver</a></div><div><a href="/hypervision" class="content-link ">mafintosh/hypervision</a></div><div><a href="/hypertweet" class="content-link ">joehand/hypertweet</a></div><div><a href="/dat-photos-app" class="content-link ">beakerbrowser/dat-photos-app</a></div><div class="f3 pt2">High-Level APIs</div><div><a href="/dat-node" class="content-link ">datproject/dat-node</a></div><div><a href="/dat-js" class="content-link ">datproject/dat-js</a></div><div><a href="/pauls-dat-api" class="content-link ">beakerbrowser/pauls-dat-api</a></div><div><a href="/node-dat-archive" class="content-link ">beakerbrowser/node-dat-archive</a></div><div class="f3 pt2">Hosting &amp; Dat Management</div><div><a href="/hypercore-archiver" class="content-link ">mafintosh/hypercore-archiver</a></div><div><a href="/hypercloud" class="content-link ">datprotocol/hypercloud</a></div><div><a href="/hashbase" class="content-link ">beakerbrowser/hashbase</a></div><div><a href="/dat-now" class="content-link ">joehand/dat-now</a></div><div><a href="/hypercore-archiver-bot" class="content-link ">mafintosh/hypercore-archiver-bot</a></div><div><a href="/hypercore-archiver-ws" class="content-link ">joehand/hypercore-archiver-ws</a></div><div><a href="/dat-registry-api" class="content-link ">datproject/dat-registry-api</a></div><div><a href="/dat-registry-client" class="content-link ">datproject/dat-registry-client</a></div><div class="f3 pt2">Managing &amp; Aggregating Dats</div><div><a href="/multidat" class="content-link ">datproject/multidat</a></div><div><a href="/multidrive" class="content-link ">datproject/multidrive</a></div><div><a href="/dat-pki" class="content-link ">jayrbolton/dat-pki</a></div><div><a href="/injestdb" class="content-link ">beakerbrowser/injestdb</a></div><div class="f3 pt2">Http Hosting</div><div><a href="/hyperdrive-http" class="content-link ">joehand/hyperdrive-http</a></div><div>
            <a href="/dathttpd" class="content-link active">beakerbrowser/dathttpd</a>
            <div class="minidocs-menu-toc">
              <a href="#getting-started" class="f5 content-link">Getting started</a><a href="#usage" class="f5 content-link">Usage</a><a href="#config" class="f5 content-link">Config</a><a href="#env-vars" class="f5 content-link">Env Vars</a><a href="#metrics-dashboard" class="f5 content-link">Metrics Dashboard</a>
            </div>
          </div><div class="f3 pt2">Dat Link Utilties</div><div><a href="/dat-dns" class="content-link ">datprotocol/dat-dns</a></div><div><a href="/dat-link-resolve" class="content-link ">joehand/dat-link-resolve</a></div><div><a href="/parse-dat-url" class="content-link ">pfrazee/parse-dat-url</a></div><div><a href="/dat-encoding" class="content-link ">juliangruber/dat-encoding</a></div><div class="f3 pt2">Dat Utilities</div><div><a href="/dat-log" class="content-link ">joehand/dat-log</a></div><div><a href="/dat-ls" class="content-link ">mafintosh/dat-ls</a></div><div><a href="/hyperhealth" class="content-link ">karissa/hyperhealth</a></div><div><a href="/hyperdrive-network-speed" class="content-link ">joehand/hyperdrive-network-speed</a></div><div class="f3 pt2">File Imports &amp; Exports</div><div><a href="/hyperdrive-import-files" class="content-link ">juliangruber/hyperdrive-import-files</a></div><div><a href="/mirror-folder" class="content-link ">mafintosh/mirror-folder</a></div><div><a href="/hyperdrive-staging-area" class="content-link ">pfrazee/hyperdrive-staging-area</a></div><div><a href="/hyperdrive-to-zip-stream" class="content-link ">pfrazee/hyperdrive-to-zip-stream</a></div><div class="f3 pt2">Hypercore Tools</div><div><a href="/hyperpipe" class="content-link ">mafintosh/hyperpipe</a></div><div class="f3 pt2">Dat Core Modules</div><div><a href="/hyperdrive" class="content-link ">mafintosh/hyperdrive</a></div><div><a href="/hypercore" class="content-link ">mafintosh/hypercore</a></div><div class="f3 pt2">CLI Utilities</div><div><a href="/dat-doctor" class="content-link ">joehand/dat-doctor</a></div><div><a href="/dat-ignore" class="content-link ">joehand/dat-ignore</a></div><div><a href="/dat-json" class="content-link ">joehand/dat-json</a></div><div class="f3 pt2">Networking</div><div><a href="/hyperdiscovery" class="content-link ">karissa/hyperdiscovery</a></div><div><a href="/discovery-swarm" class="content-link ">mafintosh/discovery-swarm</a></div><div><a href="/webrtc-swarm" class="content-link ">mafintosh/webrtc-swarm</a></div><div><a href="/dat-swarm-defaults" class="content-link ">joehand/dat-swarm-defaults</a></div><div class="f3 pt2">Lower level networking modules</div><div><a href="/discovery-channel" class="content-link ">maxogden/discovery-channel</a></div><div><a href="/dns-discovery" class="content-link ">mafintosh/dns-discovery</a></div><div><a href="/multicast-dns" class="content-link ">mafintosh/multicast-dns</a></div><div><a href="/bittorrent-dht" class="content-link ">webtorrent/bittorrent-dht</a></div><div><a href="/utp-native" class="content-link ">mafintosh/utp-native</a></div><div><a href="/signalhub" class="content-link ">mafintosh/signalhub</a></div><div class="f3 pt2">Storage</div><div><a href="/dat-storage" class="content-link ">datproject/dat-storage</a></div><div><a href="/dat-secret-storage" class="content-link ">datproject/dat-secret-storage</a></div><div class="f3 pt2">Random Access</div><div><a href="/abstract-random-access" class="content-link ">juliangruber/abstract-random-access</a></div><div><a href="/multi-random-access" class="content-link ">mafintosh/multi-random-access</a></div><div><a href="/random-access-file" class="content-link ">mafintosh/random-access-file</a></div><div><a href="/random-access-memory" class="content-link ">mafintosh/random-access-memory</a></div><div><a href="/random-access-page-files" class="content-link ">mafintosh/random-access-page-files</a></div><div><a href="/dat-http" class="content-link ">datproject/dat-http</a></div><div><a href="/random-access-idb" class="content-link ">substack/random-access-idb</a></div><div class="f3 pt2">Other Related Dat Project Modules</div><div><a href="/peer-network" class="content-link ">mafintosh/peer-network</a></div><div><a href="/hyperdht" class="content-link ">mafintosh/hyperdht</a></div><div class="f3 pt2">Dat Project Organization Stuff</div><div><a href="/datproject.org" class="content-link ">datproject/datproject.org</a></div><div><a href="/discussions" class="content-link ">datproject/discussions</a></div><div><a href="/design" class="content-link ">datproject/design</a></div><div><a href="/dat-elements" class="content-link ">datproject/dat-elements</a></div><div><a href="/dat-colors" class="content-link ">kriesse/dat-colors</a></div><div><a href="/dat-icons" class="content-link ">kriesse/dat-icons</a></div><div><a href="/dat.json" class="content-link ">juliangruber/dat.json</a></div><div class="f3 pt2">Outdated</div><div><a href="/dat.haus" class="content-link ">juliangruber/dat.haus</a></div><div><a href="/hyperfeed" class="content-link ">poga/hyperfeed</a></div><div><a href="/normcore" class="content-link ">yoshuawuyts/normcore</a></div><div><a href="/github-to-hypercore" class="content-link ">yoshuawuyts/github-to-hypercore</a></div><div><a href="/hyperspark" class="content-link ">poga/hyperspark</a></div><div><a href="/hypercore-index" class="content-link ">juliangruber/hypercore-index</a></div><div><a href="/hyperdrive-encoding" class="content-link ">juliangruber/hyperdrive-encoding</a></div><div><a href="/hyperdrive-http-server" class="content-link ">mafintosh/hyperdrive-http-server</a></div><div><a href="/hyperdrive-http" class="content-link ">joehand/hyperdrive-http</a></div><div><a href="/dat-push" class="content-link ">joehand/dat-push</a></div><div><a href="/dat-backup" class="content-link ">joehand/dat-backup</a></div><div><a href="/archiver-server" class="content-link ">joehand/archiver-server</a></div><div><a href="/archiver-api" class="content-link ">joehand/archiver-api</a></div><div><a href="/hyperdrive-ln" class="content-link ">poga/hyperdrive-ln</a></div><div><a href="/hyperdrive-multiwriter" class="content-link ">substack/hyperdrive-multiwriter</a></div><div><a href="/hyperdrive-named-archives" class="content-link ">substack/hyperdrive-named-archives</a></div><div><a href="/git-dat" class="content-link ">substack/git-dat</a></div><div><a href="/jawn" class="content-link ">CfABrigadePhiladelphia/jawn</a></div><div><a href="/dat-archiver" class="content-link ">maxogden/dat-archiver</a></div><div><a href="/hyperdrive-stats" class="content-link ">juliangruber/hyperdrive-stats</a></div><div><a href="/hypercore-stats-server" class="content-link ">karissa/hypercore-stats-server</a></div><div><a href="/hypercore-stats-ui" class="content-link ">mafintosh/hypercore-stats-ui</a></div><div><a href="/zip-to-hyperdrive" class="content-link ">karissa/zip-to-hyperdrive</a></div><div><a href="/url-dat" class="content-link ">joehand/url-dat</a></div><div><a href="/tar-dat" class="content-link ">joehand/tar-dat</a></div><div><a href="/hyperdrive-duplicate" class="content-link ">joehand/hyperdrive-duplicate</a></div>
    </div>
      </div>
        <div id="minidocs-content" class="minidocs-content-flex order-1 overflow-auto">
          <div class="_32076d68 pa3 ph5-ns pv4-ns">
    
    
    <div><h1 id="dathttpd"><a href="#dathttpd" class="anchor"></a>dathttpd</h1><p>A Web server for <a href="https://datprotocol.com">Dat</a> and HTTPS.</p>
<p>Dat sites are hosted at public keys, which are the equivalent of IP addresses in the P2P network. The pubkeys are ugly, though! Wouldn&#39;t it be nice if your dats could have nice DNS shortnames, and also rehost over HTTPS for people still on legacy browsers?</p>
<p>dathttpd is for you!</p>
<ul>
<li>Serve sites over Dat at <code>dat://{subdomain}.{yourdomain.com}</code>.</li>
<li>Rehost those sites over <code>https://{subdomain}.{yourdomain.com}</code>.</li>
<li>Get TLS certs automatically with Let&#39;s Encrypt.</li>
<li>(Optionally) Auto-redirect from https -&gt; dat.</li>
<li><a href="#metrics-dashboard">Metrics dashboard</a></li>
</ul>
<h2 id="getting-started"><a href="#getting-started" class="anchor"></a>Getting started</h2><h3 id="start-hosting-your-website-with-dat"><a href="#start-hosting-your-website-with-dat" class="anchor"></a>Start hosting your website with Dat</h3><p>You can use the <a href="https://www.npmjs.com/package/dat">Dat CLI</a> or the <a href="https://github.com/beakerbrowser/beaker">Beaker
Browser</a>.</p>
<p>After uploading your site to a Dat archive, identify the archive&#39;s URL. You&#39;ll
need this for your dathttpd config.</p>
<h3 id="update-your-dns-records"><a href="#update-your-dns-records" class="anchor"></a>Update your DNS records</h3><p>Create an A record that points to your server&#39;s IP address.</p>
<h2 id="usage"><a href="#usage" class="anchor"></a>Usage</h2><p>On your server, create a config file at <code>~/.dathttpd.yml</code>:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">letsencrypt:</span>
<span class="hljs-attr">  email:</span> <span class="hljs-string">'bob@foo.com'</span>
<span class="hljs-attr">  agreeTos:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">sites:</span>
  <span class="hljs-string">dat.local:</span>
<span class="hljs-attr">    url:</span> <span class="hljs-attr">dat://1f968afe867f06b0d344c11efc23591c7f8c5fb3b4ac938d6000f330f6ee2a03/</span>
<span class="hljs-attr">    datOnly:</span> <span class="hljs-literal">false</span>
  <span class="hljs-string">datprotocol.dat.local:</span>
<span class="hljs-attr">    url:</span> <span class="hljs-attr">dat://ff34725120b2f3c5bd5028e4f61d14a45a22af48a7b12126d5d588becde88a93/</span>
<span class="hljs-attr">    datOnly:</span> <span class="hljs-literal">true</span>
</code></pre>
<p>Then run</p>
<pre><code># install build dependencies
sudo apt-get install libtool m4 automake

# install dathttpd (https:<span class="hljs-comment">//docs.npmjs.com/getting-started/fixing-npm-permissions)</span>
npm install -g dathttpd

# give node perms to use ports <span class="hljs-number">80</span> and <span class="hljs-number">443</span>
sudo setcap cap_net_bind_service=+ep `readlink -f \`which node\``

# start dathttpd
dathttpd
</code></pre><p>To daemonify the server in Debian-based systems, stop the dathttpd process and
then run:</p>
<pre><code><span class="hljs-comment"># install a helper tool</span>
npm install -g<span class="hljs-built_in"> add-to-systemd
</span>
<span class="hljs-comment"># create a systemd entry for dathttpd</span>
sudo<span class="hljs-built_in"> add-to-systemd </span>dathttpd --user $(whoami) $(which dathttpd)

<span class="hljs-comment"># start the dathttpd service</span>
sudo<span class="hljs-keyword"> system</span>ctl start dathttpd
</code></pre><h2 id="config"><a href="#config" class="anchor"></a>Config</h2><p>Here&#39;s an example <code>~/.dathttpd.yml</code>:</p>
<pre><code class="lang-yaml"><span class="hljs-attr">ports:</span>
<span class="hljs-attr">  http:</span> <span class="hljs-number">80</span>
<span class="hljs-attr">  https:</span> <span class="hljs-number">443</span>
<span class="hljs-attr">  metric:</span> <span class="hljs-number">8089</span>
<span class="hljs-attr">directory:</span> <span class="hljs-string">~/.dathttpd</span>
<span class="hljs-attr">letsencrypt:</span>
<span class="hljs-attr">  email:</span> <span class="hljs-string">'bob@foo.com'</span>
<span class="hljs-attr">  agreeTos:</span> <span class="hljs-literal">true</span>
<span class="hljs-attr">sites:</span>
  <span class="hljs-string">dat.local:</span>
<span class="hljs-attr">    url:</span> <span class="hljs-attr">dat://1f968afe867f06b0d344c11efc23591c7f8c5fb3b4ac938d6000f330f6ee2a03/</span>
<span class="hljs-attr">    datOnly:</span> <span class="hljs-literal">false</span>
  <span class="hljs-string">datprotocol.dat.local:</span>
<span class="hljs-attr">    url:</span> <span class="hljs-attr">dat://ff34725120b2f3c5bd5028e4f61d14a45a22af48a7b12126d5d588becde88a93/</span>
<span class="hljs-attr">    datOnly:</span> <span class="hljs-literal">true</span>
  <span class="hljs-string">proxy.local:</span>
<span class="hljs-attr">    proxy:</span> <span class="hljs-attr">http://localhost:8080</span>
</code></pre>
<h3 id="portshttp"><a href="#portshttp" class="anchor"></a>ports.http</h3><p>The port to serve the HTTP sites. Defaults to 80. (Optional)</p>
<p>HTTP automatically redirects to HTTPS.</p>
<h3 id="portshttps"><a href="#portshttps" class="anchor"></a>ports.https</h3><p>The port to serve the HTTPS sites. Defaults to 443. (Optional)</p>
<h3 id="portsmetric"><a href="#portsmetric" class="anchor"></a>ports.metric</h3><p>The port to serve the prometheus metrics. Defaults to 8089. (Optional)</p>
<h3 id="directory"><a href="#directory" class="anchor"></a>directory</h3><p>The directory where dathttpd will store your Dat archive&#39;s files. Defaults to ~/.dathttpd. (Optional)</p>
<h3 id="letsencrypt"><a href="#letsencrypt" class="anchor"></a>letsencrypt</h3><p>Settings for LetsEncrypt. If false or unset, HTTPS will be disabled.</p>
<h3 id="letsencryptemail"><a href="#letsencryptemail" class="anchor"></a>letsencrypt.email</h3><p>The email to send Lets Encrypt? notices to. (Required)</p>
<h3 id="letsencryptagreetos"><a href="#letsencryptagreetos" class="anchor"></a>letsencrypt.agreeTos</h3><p>Do you agree to the terms of service of Lets Encrypt? (Required, must be true)</p>
<h3 id="sites"><a href="#sites" class="anchor"></a>sites</h3><p>A listing of the sites to host. Each site is labeled (keyed) by the hostname you want the site to serve at.</p>
<p>Sites can either host dat archives or proxy to a URL. To make a dat-site, set the <code>url</code> attribute. To make a proxy, set the <code>proxy</code> attribute.</p>
<p>You&#39;ll need to configure the DNS entry for the hostname to point to the server. For instance, if using <code>site.myhostname.com</code>, you&#39;ll need a DNS entry pointing <code>site.myhostname.com</code> to the server.</p>
<h3 id="siteshostnameurl"><a href="#siteshostnameurl" class="anchor"></a>sites.{hostname}.url</h3><p>The Dat URL of the site to host.</p>
<h3 id="siteshostnameproxy"><a href="#siteshostnameproxy" class="anchor"></a>sites.{hostname}.proxy</h3><p>The HTTP URL of the site to proxy.</p>
<h3 id="siteshostnamedatonly"><a href="#siteshostnamedatonly" class="anchor"></a>sites.{hostname}.datOnly</h3><p>If true, rather than serve the assets over HTTPS, dathttpd will serve a redirect to the dat:// location. Defaults to false. (Optional)</p>
<h2 id="env-vars"><a href="#env-vars" class="anchor"></a>Env Vars</h2><ul>
<li><code>DATHTTPD_CONFIG=cfg_file_path</code> specify an alternative path to the config than <code>~/.dathttpd.yml</code></li>
<li><code>NODE_ENV=debug|staging|production</code> set to <code>debug</code> or <code>staging</code> to use the lets-encrypt testing servers.</li>
</ul>
<h2 id="metrics-dashboard"><a href="#metrics-dashboard" class="anchor"></a>Metrics Dashboard</h2><p>DatHTTPD has built-in support for <a href="https://prometheus.io">Prometheus</a>, which can be visualized by <a href="http://grafana.org/">Grafana</a>.</p>
<p><img src="./grafana-screenshot.png" alt="./grafana-screenshot.png"></p>
<p>DatHTTPD exposes its metrics at port 8089. Prometheus periodically scrapes the metrics, and stores them in a database. Grafana provides a nice dashboard. It&#39;s a little daunting at first, but setup should be relatively painless.</p>
<p>Follow these steps:</p>
<ol>
<li><a href="https://prometheus.io/download/">Install Prometheus</a> on your server.</li>
<li><a href="http://grafana.org/download/">Install Grafana</a> on your server.</li>
<li>Update the <code>prometheus.yml</code> config.</li>
<li>Start prometheus and grafana.</li>
<li>Login to grafana.</li>
<li>Add prometheus as a data source to grafana. (It should be running at localhost:9090.)</li>
<li>Import <a href="./grafana-dashboard.json">this grafana dashboard</a>.</li>
</ol>
<p>Your prometheus.yml config should include have the scrape_configs set like this:</p>
<pre><code class="lang-yml"><span class="hljs-attr">scrape_configs:</span>
<span class="hljs-attr">  - job_name:</span> <span class="hljs-string">'prometheus'</span>
<span class="hljs-attr">    static_configs:</span>
<span class="hljs-attr">      - targets:</span> <span class="hljs-string">['localhost:9090']</span>
<span class="hljs-attr">  - job_name:</span> <span class="hljs-string">'dathttpd'</span>
<span class="hljs-attr">    static_configs:</span>
<span class="hljs-attr">      - targets:</span> <span class="hljs-string">['localhost:8089']</span>
</code></pre>
<p>Report any issues you have along the way!</p>
</div>
  </div>
        </div>
      </main>
    </div>
<script src="/bundle.js"></script>
</body>
</html>
